{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import glob\n",
    "from collections import OrderedDict,defaultdict\n",
    "import pipes\n",
    "import pprint\n",
    "import tempfile\n",
    "import re"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "root_dir = 'HepG2_Control_data'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "####Fixed length 1e6 = 100 blocks. \n",
    "####Fixed length 5e5 = 200 blocks. \n",
    "Fixed_length = 1.5e6"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "def binary_locate(array,ele,start,end):\n",
    "    middle = (end+start)//2\n",
    "    if(end-start>1):\n",
    "        if(array[middle]<ele):\n",
    "            return binary_locate(array,ele,middle,end)\n",
    "        elif(array[middle+1]>ele):\n",
    "            return binary_locate(array,ele,start,middle)\n",
    "        else:\n",
    "            return middle,middle+1\n",
    "    else:\n",
    "        return middle,middle+1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "p = pipes.Template()\n",
    "p.append(\"zcat\", '--')\n",
    "Gene_Loc = defaultdict(list)\n",
    "f = p.open('/home/longy/cnda/ensembl/Homo_sapiens.GRCh38.103.gtf.gz', 'r')\n",
    "\n",
    "#f = p.open('/home/longy/cnda/ensembl/Mus_musculus.GRCm38.102.gtf.gz', 'r')\n",
    "for line in f.readlines():\n",
    "    if re.match('^#',line):\n",
    "        continue\n",
    "    line = line.rstrip('\\n')\n",
    "    data = line.split('\\t')\n",
    "    if(data[2] == 'gene'):\n",
    "        Gene_Loc['chr'+data[0]+data[6]].append(int(data[3]))\n",
    "        Gene_Loc['chr'+data[0]+data[6]].append(int(data[4]))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(1523, 1524)"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import sys\n",
    "sys.setrecursionlimit(10000)\n",
    "array = Gene_Loc['chr1+']\n",
    "binary_locate(array,46104790,0,3505)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file HepG2_Control_data/Blocks/chr18_-_0_47258-22170047\n",
      "writing file HepG2_Control_data/Blocks/chr18_-_1_22181503-47877708\n",
      "writing file HepG2_Control_data/Blocks/chr18_-_2_47878770-80247346\n",
      "writing file HepG2_Control_data/Blocks/chr20_-_0_131393-18420855\n",
      "writing file HepG2_Control_data/Blocks/chr20_-_1_18421856-35412041\n",
      "writing file HepG2_Control_data/Blocks/chr20_-_2_35427416-47359105\n",
      "writing file HepG2_Control_data/Blocks/chr20_-_3_47365294-64275342\n",
      "writing file HepG2_Control_data/Blocks/chr20_+_0_61003-10051941\n",
      "writing file HepG2_Control_data/Blocks/chr20_+_1_10053124-31924063\n",
      "writing file HepG2_Control_data/Blocks/chr20_+_2_31925432-37876099\n",
      "writing file HepG2_Control_data/Blocks/chr20_+_3_37891603-49295814\n",
      "writing file HepG2_Control_data/Blocks/chr20_+_4_49297003-64318412\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_0_15929-20352235\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_1_20353902-37334086\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_2_37339584-53971006\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_3_53972938-69388316\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_4_69389569-78297121\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_5_78298247-100386395\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_6_100390127-127389254\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_7_127400624-156368841\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_8_156451748-171253843\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_9_171254999-187566988\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_10_187598600-210502723\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_11_210582612-233013479\n",
      "writing file HepG2_Control_data/Blocks/chr2_-_12_233169300-242128577\n",
      "writing file HepG2_Control_data/Blocks/chr5_+_0_92162-41921657\n",
      "writing file HepG2_Control_data/Blocks/chr5_+_1_41923120-66184890\n",
      "writing file HepG2_Control_data/Blocks/chr5_+_2_66187917-80483908\n",
      "writing file HepG2_Control_data/Blocks/chr5_+_3_80486303-103048726\n",
      "writing file HepG2_Control_data/Blocks/chr5_+_4_103120264-129386767\n",
      "writing file HepG2_Control_data/Blocks/chr5_+_5_129388059-140663146\n",
      "writing file HepG2_Control_data/Blocks/chr5_+_6_140664828-154879730\n",
      "writing file HepG2_Control_data/Blocks/chr5_+_7_154881494-181474203\n",
      "writing file HepG2_Control_data/Blocks/chr12_+_0_12809-12496170\n",
      "writing file HepG2_Control_data/Blocks/chr12_+_1_12501081-45479807\n",
      "writing file HepG2_Control_data/Blocks/chr12_+_2_45481410-56147223\n",
      "writing file HepG2_Control_data/Blocks/chr12_+_3_56148362-70572413\n",
      "writing file HepG2_Control_data/Blocks/chr12_+_4_70573551-102306943\n",
      "writing file HepG2_Control_data/Blocks/chr12_+_5_102311797-120019466\n",
      "writing file HepG2_Control_data/Blocks/chr12_+_6_120026532-133214262\n",
      "writing file HepG2_Control_data/Blocks/chr17_-_0_63863-6657747\n",
      "writing file HepG2_Control_data/Blocks/chr17_-_1_6659739-18856175\n",
      "writing file HepG2_Control_data/Blocks/chr17_-_2_18865446-37406971\n",
      "writing file HepG2_Control_data/Blocks/chr17_-_3_37453187-44187974\n",
      "writing file HepG2_Control_data/Blocks/chr17_-_4_44188999-50833484\n",
      "writing file HepG2_Control_data/Blocks/chr17_-_5_50841315-65057964\n",
      "writing file HepG2_Control_data/Blocks/chr17_-_6_65063409-76385779\n",
      "writing file HepG2_Control_data/Blocks/chr17_-_7_76387419-83101434\n",
      "writing file HepG2_Control_data/Blocks/chr6_-_0_109999-11044341\n",
      "writing file HepG2_Control_data/Blocks/chr6_-_1_11092714-29946919\n",
      "writing file HepG2_Control_data/Blocks/chr6_-_2_29948489-38642046\n",
      "writing file HepG2_Control_data/Blocks/chr6_-_3_38644592-53564877\n",
      "writing file HepG2_Control_data/Blocks/chr6_-_4_53567505-89821938\n",
      "writing file HepG2_Control_data/Blocks/chr6_-_5_89823661-114016760\n",
      "writing file HepG2_Control_data/Blocks/chr6_-_6_114028583-132444291\n",
      "writing file HepG2_Control_data/Blocks/chr6_-_7_132445812-149782377\n",
      "writing file HepG2_Control_data/Blocks/chr6_-_8_149785087-170584538\n",
      "writing file HepG2_Control_data/Blocks/chr7_-_0_20251-23470827\n",
      "writing file HepG2_Control_data/Blocks/chr7_-_1_23481122-44019159\n",
      "writing file HepG2_Control_data/Blocks/chr7_-_2_44020504-73697892\n",
      "writing file HepG2_Control_data/Blocks/chr7_-_3_73699227-95396916\n",
      "writing file HepG2_Control_data/Blocks/chr7_-_4_95399885-103989685\n",
      "writing file HepG2_Control_data/Blocks/chr7_-_5_104002232-127807561\n",
      "writing file HepG2_Control_data/Blocks/chr7_-_6_127814279-143971545\n",
      "writing file HepG2_Control_data/Blocks/chr7_-_7_144178563-158977058\n",
      "writing file HepG2_Control_data/Blocks/chrX_-_0_15952-24673539\n",
      "writing file HepG2_Control_data/Blocks/chrX_-_1_24704390-54923060\n",
      "writing file HepG2_Control_data/Blocks/chrX_-_2_54924445-100827023\n",
      "writing file HepG2_Control_data/Blocks/chrX_-_3_100828044-131797749\n",
      "writing file HepG2_Control_data/Blocks/chrX_-_4_131799172-156022489\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_0_14386-8823541\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_1_8825623-21108259\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_2_21111300-31938373\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_3_32010353-44287181\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_4_44289002-54888288\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_5_54896966-85609225\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_6_85610264-108968259\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_7_108970191-148324112\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_8_148333104-156711059\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_9_156712189-182189130\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_10_182190289-211830734\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_11_211933258-231767186\n",
      "writing file HepG2_Control_data/Blocks/chr1_-_12_231839119-248935561\n",
      "writing file HepG2_Control_data/Blocks/chr22_+_0_11035994-29059254\n",
      "writing file HepG2_Control_data/Blocks/chr22_+_1_29060261-41360606\n",
      "writing file HepG2_Control_data/Blocks/chr22_+_2_41361840-50804485\n",
      "writing file HepG2_Control_data/Blocks/chr22_-_0_10684462-28483194\n",
      "writing file HepG2_Control_data/Blocks/chr22_-_1_28484471-37937807\n",
      "writing file HepG2_Control_data/Blocks/chr22_-_2_37940686-50788790\n",
      "writing file HepG2_Control_data/Blocks/chr8_+_0_211474-23268079\n",
      "writing file HepG2_Control_data/Blocks/chr8_+_1_23269190-43030521\n",
      "writing file HepG2_Control_data/Blocks/chr8_+_2_43033434-86482977\n",
      "writing file HepG2_Control_data/Blocks/chr8_+_3_86485738-122975241\n",
      "writing file HepG2_Control_data/Blocks/chr8_+_4_122993771-145073331\n",
      "writing file HepG2_Control_data/Blocks/chr16_+_0_23102-5096018\n",
      "writing file HepG2_Control_data/Blocks/chr16_+_1_5098033-20750846\n",
      "writing file HepG2_Control_data/Blocks/chr16_+_2_20752266-30363589\n",
      "writing file HepG2_Control_data/Blocks/chr16_+_3_30368141-55502913\n",
      "writing file HepG2_Control_data/Blocks/chr16_+_4_55505350-69204879\n",
      "writing file HepG2_Control_data/Blocks/chr16_+_5_69207700-81712421\n",
      "writing file HepG2_Control_data/Blocks/chr16_+_6_81716621-90227757\n",
      "writing file HepG2_Control_data/Blocks/chr4_-_0_131852-15694198\n",
      "writing file HepG2_Control_data/Blocks/chr4_-_1_15700195-54064630\n",
      "writing file HepG2_Control_data/Blocks/chr4_-_2_54066644-87822768\n",
      "writing file HepG2_Control_data/Blocks/chr4_-_3_87825619-118690595\n",
      "writing file HepG2_Control_data/Blocks/chr4_-_4_118698615-152317303\n",
      "writing file HepG2_Control_data/Blocks/chr4_-_5_152318338-190113340\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_0_40184-24076280\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_1_24077987-36555775\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_2_36556959-47691291\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_3_47694210-65273853\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_4_65275021-85322639\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_5_85324897-102180756\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_6_102181917-119986243\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_7_119987344-149026760\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_8_149214744-170093992\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_9_170095038-186019567\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_10_186055175-202542470\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_11_202545493-218825786\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_12_218828190-235534079\n",
      "writing file HepG2_Control_data/Blocks/chr2_+_13_235535384-242180082\n",
      "writing file HepG2_Control_data/Blocks/chr21_+_0_5032202-37255801\n",
      "writing file HepG2_Control_data/Blocks/chr21_+_1_37258588-46696364\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file HepG2_Control_data/Blocks/chr21_-_0_5012996-35476188\n",
      "writing file HepG2_Control_data/Blocks/chr21_-_1_35477915-46665873\n",
      "writing file HepG2_Control_data/Blocks/chr3_+_0_265370-18540362\n",
      "writing file HepG2_Control_data/Blocks/chr3_+_1_18906265-40576129\n",
      "writing file HepG2_Control_data/Blocks/chr3_+_2_40587760-51704345\n",
      "writing file HepG2_Control_data/Blocks/chr3_+_3_51708089-82464107\n",
      "writing file HepG2_Control_data/Blocks/chr3_+_4_82466881-122733818\n",
      "writing file HepG2_Control_data/Blocks/chr3_+_5_122735673-138300511\n",
      "writing file HepG2_Control_data/Blocks/chr3_+_6_138301746-161267130\n",
      "writing file HepG2_Control_data/Blocks/chr3_+_7_161268476-185491780\n",
      "writing file HepG2_Control_data/Blocks/chr3_+_8_185494635-198232745\n",
      "writing file HepG2_Control_data/Blocks/chr18_+_0_74569-21871426\n",
      "writing file HepG2_Control_data/Blocks/chr18_+_1_21875830-54327115\n",
      "writing file HepG2_Control_data/Blocks/chr18_+_2_54357920-80251822\n",
      "writing file HepG2_Control_data/Blocks/chr9_+_0_29614-30690983\n",
      "writing file HepG2_Control_data/Blocks/chr9_+_1_31222212-41066470\n",
      "writing file HepG2_Control_data/Blocks/chr9_+_2_41067836-87711255\n",
      "writing file HepG2_Control_data/Blocks/chr9_+_3_87723305-100384347\n",
      "writing file HepG2_Control_data/Blocks/chr9_+_4_100386075-120856984\n",
      "writing file HepG2_Control_data/Blocks/chr9_+_5_120871168-129171113\n",
      "writing file HepG2_Control_data/Blocks/chr9_+_6_129172209-138309822\n",
      "writing file HepG2_Control_data/Blocks/chr11_+_0_130895-14899227\n",
      "writing file HepG2_Control_data/Blocks/chr11_+_1_14904141-43809751\n",
      "writing file HepG2_Control_data/Blocks/chr11_+_2_43811278-64248602\n",
      "writing file HepG2_Control_data/Blocks/chr11_+_3_64251620-70438230\n",
      "writing file HepG2_Control_data/Blocks/chr11_+_4_70442023-87215695\n",
      "writing file HepG2_Control_data/Blocks/chr11_+_5_87217305-117213950\n",
      "writing file HepG2_Control_data/Blocks/chr11_+_6_117215616-134761205\n",
      "writing file HepG2_Control_data/Blocks/chr4_+_0_14793-15070171\n",
      "writing file HepG2_Control_data/Blocks/chr4_+_1_15118444-55431997\n",
      "writing file HepG2_Control_data/Blocks/chr4_+_2_55433042-82355424\n",
      "writing file HepG2_Control_data/Blocks/chr4_+_3_82356549-113360936\n",
      "writing file HepG2_Control_data/Blocks/chr4_+_4_113361990-146196050\n",
      "writing file HepG2_Control_data/Blocks/chr4_+_5_146197346-190199602\n",
      "writing file HepG2_Control_data/Blocks/chr12_-_0_10594-13001015\n",
      "writing file HepG2_Control_data/Blocks/chr12_-_1_13023861-39443691\n",
      "writing file HepG2_Control_data/Blocks/chr12_-_2_39488434-56088856\n",
      "writing file HepG2_Control_data/Blocks/chr12_-_3_56092963-80845927\n",
      "writing file HepG2_Control_data/Blocks/chr12_-_4_80847002-108734756\n",
      "writing file HepG2_Control_data/Blocks/chr12_-_5_108738293-120469772\n",
      "writing file HepG2_Control_data/Blocks/chr12_-_6_120472947-133209425\n",
      "writing file HepG2_Control_data/Blocks/chr7_+_0_12780-17060364\n",
      "writing file HepG2_Control_data/Blocks/chr7_+_1_17062192-38230685\n",
      "writing file HepG2_Control_data/Blocks/chr7_+_2_38232200-66813369\n",
      "writing file HepG2_Control_data/Blocks/chr7_+_3_66814943-90274417\n",
      "writing file HepG2_Control_data/Blocks/chr7_+_4_90275420-100573630\n",
      "writing file HepG2_Control_data/Blocks/chr7_+_5_100575092-128015949\n",
      "writing file HepG2_Control_data/Blocks/chr7_+_6_128017915-140024504\n",
      "writing file HepG2_Control_data/Blocks/chr7_+_7_140030436-159233160\n",
      "writing file HepG2_Control_data/Blocks/chr16_-_0_10016-8976469\n",
      "writing file HepG2_Control_data/Blocks/chr16_-_1_8986182-22501310\n",
      "writing file HepG2_Control_data/Blocks/chr16_-_2_22506516-47354854\n",
      "writing file HepG2_Control_data/Blocks/chr16_-_3_47356414-68310928\n",
      "writing file HepG2_Control_data/Blocks/chr16_-_4_68315938-75556266\n",
      "writing file HepG2_Control_data/Blocks/chr16_-_5_75560368-90171429\n",
      "writing file HepG2_Control_data/Blocks/chr6_+_0_180738-15477242\n",
      "writing file HepG2_Control_data/Blocks/chr6_+_1_15478986-31511147\n",
      "writing file HepG2_Control_data/Blocks/chr6_+_2_31512556-42087635\n",
      "writing file HepG2_Control_data/Blocks/chr6_+_3_42090537-70529787\n",
      "writing file HepG2_Control_data/Blocks/chr6_+_4_70530900-107666211\n",
      "writing file HepG2_Control_data/Blocks/chr6_+_5_107668021-122441884\n",
      "writing file HepG2_Control_data/Blocks/chr6_+_6_122443567-144445051\n",
      "writing file HepG2_Control_data/Blocks/chr6_+_7_144446064-157639087\n",
      "writing file HepG2_Control_data/Blocks/chr6_+_8_157640330-170745582\n",
      "writing file HepG2_Control_data/Blocks/chr15_-_0_17016359-42274060\n",
      "writing file HepG2_Control_data/Blocks/chr15_-_1_42385680-56015156\n",
      "writing file HepG2_Control_data/Blocks/chr15_-_2_56068892-67066323\n",
      "writing file HepG2_Control_data/Blocks/chr15_-_3_67175092-80989856\n",
      "writing file HepG2_Control_data/Blocks/chr15_-_4_80995982-101975153\n",
      "writing file HepG2_Control_data/Blocks/chr13_-_0_18172699-40484887\n",
      "writing file HepG2_Control_data/Blocks/chr13_-_1_40486124-60036617\n",
      "writing file HepG2_Control_data/Blocks/chr13_-_2_60041040-114345008\n",
      "writing file HepG2_Control_data/Blocks/chrX_+_0_20518-41237731\n",
      "writing file HepG2_Control_data/Blocks/chrX_+_1_41276331-70397984\n",
      "writing file HepG2_Control_data/Blocks/chrX_+_2_70399057-118775313\n",
      "writing file HepG2_Control_data/Blocks/chrX_+_3_118776383-156025694\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_0_12498-10332521\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_1_10333689-23766125\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_2_23770119-32859929\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_3_32860969-43158111\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_4_43159495-56716338\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_5_56717846-84211004\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_6_84212907-100293871\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_7_100295894-119278590\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_8_119283112-155087561\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_9_155091828-169501003\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_10_169503738-189570205\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_11_189596674-213275326\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_12_213276419-229341846\n",
      "writing file HepG2_Control_data/Blocks/chr1_+_13_229407134-248942385\n",
      "writing file HepG2_Control_data/Blocks/chr19_-_0_60102-5978186\n",
      "writing file HepG2_Control_data/Blocks/chr19_-_1_5986636-13164465\n",
      "writing file HepG2_Control_data/Blocks/chr19_-_2_13167405-29716111\n",
      "writing file HepG2_Control_data/Blocks/chr19_-_3_29733033-41444445\n",
      "writing file HepG2_Control_data/Blocks/chr19_-_4_41479231-50348457\n",
      "writing file HepG2_Control_data/Blocks/chr19_-_5_50361469-58597658\n",
      "writing file HepG2_Control_data/Blocks/chr5_-_0_16111-37249359\n",
      "writing file HepG2_Control_data/Blocks/chr5_-_1_37282132-60919904\n",
      "writing file HepG2_Control_data/Blocks/chr5_-_2_60921360-80256085\n",
      "writing file HepG2_Control_data/Blocks/chr5_-_3_80259756-115262937\n",
      "writing file HepG2_Control_data/Blocks/chr5_-_4_115265764-138180037\n",
      "writing file HepG2_Control_data/Blocks/chr5_-_5_138181084-157707919\n",
      "writing file HepG2_Control_data/Blocks/chr5_-_6_157712567-181294203\n",
      "writing file HepG2_Control_data/Blocks/chr10_-_0_41124-27090120\n",
      "writing file HepG2_Control_data/Blocks/chr10_-_1_27091195-49560687\n",
      "writing file HepG2_Control_data/Blocks/chr10_-_2_49719094-73372306\n",
      "writing file HepG2_Control_data/Blocks/chr10_-_3_73374016-95586057\n",
      "writing file HepG2_Control_data/Blocks/chr10_-_4_95597738-110304941\n",
      "writing file HepG2_Control_data/Blocks/chr10_-_5_110308257-133640363\n",
      "writing file HepG2_Control_data/Blocks/chr19_+_0_210249-8409147\n",
      "writing file HepG2_Control_data/Blocks/chr19_+_1_8411917-17240984\n",
      "writing file HepG2_Control_data/Blocks/chr19_+_2_17245075-34479800\n",
      "writing file HepG2_Control_data/Blocks/chr19_+_3_34482026-43898731\n",
      "writing file HepG2_Control_data/Blocks/chr19_+_4_43900364-50419364\n",
      "writing file HepG2_Control_data/Blocks/chr19_+_5_50426739-58604859\n",
      "writing file HepG2_Control_data/Blocks/chr3_-_0_478920-15779083\n",
      "writing file HepG2_Control_data/Blocks/chr3_-_1_15780661-40453283\n",
      "writing file HepG2_Control_data/Blocks/chr3_-_2_40455393-50195724\n",
      "writing file HepG2_Control_data/Blocks/chr3_-_3_50201189-65949649\n",
      "writing file HepG2_Control_data/Blocks/chr3_-_4_65950667-101322944\n",
      "writing file HepG2_Control_data/Blocks/chr3_-_5_101324141-122565675\n",
      "writing file HepG2_Control_data/Blocks/chr3_-_6_122654744-134374866\n",
      "writing file HepG2_Control_data/Blocks/chr3_-_7_134436434-156555167\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file HepG2_Control_data/Blocks/chr3_-_8_156568997-186362436\n",
      "writing file HepG2_Control_data/Blocks/chr3_-_9_186435589-198169006\n",
      "writing file HepG2_Control_data/Blocks/chr9_-_0_11200-32573158\n",
      "writing file HepG2_Control_data/Blocks/chr9_-_1_32630829-67702020\n",
      "writing file HepG2_Control_data/Blocks/chr9_-_2_67711612-92115441\n",
      "writing file HepG2_Control_data/Blocks/chr9_-_3_92147528-105239731\n",
      "writing file HepG2_Control_data/Blocks/chr9_-_4_105240997-121563457\n",
      "writing file HepG2_Control_data/Blocks/chr9_-_5_121591676-130679215\n",
      "writing file HepG2_Control_data/Blocks/chr9_-_6_130682393-137835359\n",
      "writing file HepG2_Control_data/Blocks/chr8_-_0_60073-25185447\n",
      "writing file HepG2_Control_data/Blocks/chr8_-_1_25256374-52795849\n",
      "writing file HepG2_Control_data/Blocks/chr8_-_2_52954434-81753080\n",
      "writing file HepG2_Control_data/Blocks/chr8_-_3_81799607-110079947\n",
      "writing file HepG2_Control_data/Blocks/chr8_-_4_110601727-133357909\n",
      "writing file HepG2_Control_data/Blocks/chr8_-_5_133363234-145052885\n",
      "writing file HepG2_Control_data/Blocks/chr11_-_0_109438-12944961\n",
      "writing file HepG2_Control_data/Blocks/chr11_-_1_12947387-35618527\n",
      "writing file HepG2_Control_data/Blocks/chr11_-_2_35619933-63813801\n",
      "writing file HepG2_Control_data/Blocks/chr11_-_3_63817782-71947045\n",
      "writing file HepG2_Control_data/Blocks/chr11_-_4_71991435-85819855\n",
      "writing file HepG2_Control_data/Blocks/chr11_-_5_85822163-115339697\n",
      "writing file HepG2_Control_data/Blocks/chr11_-_6_115340728-135065788\n",
      "writing file HepG2_Control_data/Blocks/chr13_+_0_18173639-38077447\n",
      "writing file HepG2_Control_data/Blocks/chr13_+_1_38078867-51464747\n",
      "writing file HepG2_Control_data/Blocks/chr13_+_2_51465771-98391086\n",
      "writing file HepG2_Control_data/Blocks/chr13_+_3_98392454-114350686\n",
      "writing file HepG2_Control_data/Blocks/chr17_+_0_77534-13480243\n",
      "writing file HepG2_Control_data/Blocks/chr17_+_1_13486481-21315678\n",
      "writing file HepG2_Control_data/Blocks/chr17_+_2_21504611-37001864\n",
      "writing file HepG2_Control_data/Blocks/chr17_+_3_37003099-44755425\n",
      "writing file HepG2_Control_data/Blocks/chr17_+_4_44757216-57130713\n",
      "writing file HepG2_Control_data/Blocks/chr17_+_5_57132894-66729770\n",
      "writing file HepG2_Control_data/Blocks/chr17_+_6_66731429-77502491\n",
      "writing file HepG2_Control_data/Blocks/chr17_+_7_77504181-83244758\n",
      "writing file HepG2_Control_data/Blocks/chr14_-_0_16027358-34421845\n",
      "writing file HepG2_Control_data/Blocks/chr14_-_1_34423440-53253932\n",
      "writing file HepG2_Control_data/Blocks/chr14_-_2_53460015-73027142\n",
      "writing file HepG2_Control_data/Blocks/chr14_-_3_73031784-91424067\n",
      "writing file HepG2_Control_data/Blocks/chr14_-_4_91435300-106874410\n",
      "writing file HepG2_Control_data/Blocks/chr15_+_0_18415773-41848424\n",
      "writing file HepG2_Control_data/Blocks/chr15_+_1_41849833-58538542\n",
      "writing file HepG2_Control_data/Blocks/chr15_+_2_58539786-71824165\n",
      "writing file HepG2_Control_data/Blocks/chr15_+_3_71826436-85143013\n",
      "writing file HepG2_Control_data/Blocks/chr15_+_4_85146166-101980284\n",
      "writing file HepG2_Control_data/Blocks/chr14_+_0_16023309-32717599\n",
      "writing file HepG2_Control_data/Blocks/chr14_+_1_32732466-52787694\n",
      "writing file HepG2_Control_data/Blocks/chr14_+_2_52789352-65059759\n",
      "writing file HepG2_Control_data/Blocks/chr14_+_3_65060844-74859456\n",
      "writing file HepG2_Control_data/Blocks/chr14_+_4_74865692-95187806\n",
      "writing file HepG2_Control_data/Blocks/chr14_+_5_95188824-106883363\n",
      "writing file HepG2_Control_data/Blocks/chr10_+_0_75552-24322881\n",
      "writing file HepG2_Control_data/Blocks/chr10_+_1_24324435-50645037\n",
      "writing file HepG2_Control_data/Blocks/chr10_+_2_50647957-74373716\n",
      "writing file HepG2_Control_data/Blocks/chr10_+_3_74377554-87959508\n",
      "writing file HepG2_Control_data/Blocks/chr10_+_4_87960904-101557972\n",
      "writing file HepG2_Control_data/Blocks/chr10_+_5_101560434-119771311\n",
      "writing file HepG2_Control_data/Blocks/chr10_+_6_119773855-133780417\n"
     ]
    }
   ],
   "source": [
    "total = 0\n",
    "files = glob.glob(root_dir+\"/*.txt\")\n",
    "info = open(root_dir+'/Blocks/info.txt','w')\n",
    "info.write('ID\\tstart\\tend\\tlength\\tsites_num\\n')\n",
    "for file in files:\n",
    "    num_lines = sum(1 for line in open(file))\n",
    "    num_blocks = round(num_lines/Fixed_length)\n",
    "    len_blocks = num_lines/num_blocks\n",
    "    \n",
    "    f= open(file,'r')\n",
    "    pre_pos = 0\n",
    "    dict_line = OrderedDict()\n",
    "    #dict_line = dict()\n",
    "    count = 0\n",
    "    separate_num=0\n",
    "    save_block = 0\n",
    "    start = 0\n",
    "    \n",
    "    for i, line in enumerate(f):\n",
    "        line = line.rstrip('\\n')\n",
    "        if(i==0):\n",
    "            continue ###Skip header\n",
    "        chromosome,pos,strand = line.split('\\t')[0].split(':')\n",
    "        pos = int(pos)\n",
    "        count += 1\n",
    "        if(i==1):\n",
    "            start=pos\n",
    "        if(count>len_blocks and pos-pre_pos>1000 and save_block<num_blocks-1):\n",
    "            array = Gene_Loc[chromosome+strand]\n",
    "            index1,index2 = binary_locate(array,pre_pos,0,len(array)-1)\n",
    "            if(index1%2==1 and index2%2==0):\n",
    "                ww = open(root_dir+'/Blocks/%s_%s_%d'%(chromosome,strand,save_block),'w')\n",
    "                print('writing file '+root_dir+'/Blocks/%s_%s_%d_%d-%d'%(chromosome,strand,save_block,start,pre_pos))\n",
    "                info.write('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "                #print('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "                for key,val in dict_line.items():\n",
    "                    ww.write('%s\\n'%val)\n",
    "                ww.close()\n",
    "                dict_line.clear()\n",
    "                count = 0\n",
    "                save_block += 1\n",
    "                start  = pos\n",
    "            \n",
    "        \n",
    "        dict_line[pos] = line\n",
    "        pre_pos = pos\n",
    "        \n",
    "    out = open(root_dir+'/Blocks/%s_%s_%d'%(chromosome,strand,save_block),'w')\n",
    "    print('writing file '+root_dir+'/Blocks/%s_%s_%d_%d-%d'%(chromosome,strand,save_block,start,pre_pos))\n",
    "    info.write('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "    for key,val in dict_line.items():\n",
    "        out.write('%s\\n'%(val))\n",
    "    out.close()\n",
    "\n",
    "info.close()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
