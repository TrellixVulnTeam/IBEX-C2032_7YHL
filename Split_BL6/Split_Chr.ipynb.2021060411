{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import glob\n",
    "from collections import OrderedDict,defaultdict\n",
    "import pipes\n",
    "import pprint\n",
    "import tempfile\n",
    "import re"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "root_dir = 'K562_Chen_data'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "####Fixed length 1e6 = 100 blocks. \n",
    "####Fixed length 5e5 = 200 blocks. \n",
    "Fixed_length = 1e6"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "def binary_locate(array,ele,start,end):\n",
    "    middle = (end+start)//2\n",
    "    if(end-start>1):\n",
    "        if(array[middle]<ele):\n",
    "            return binary_locate(array,ele,middle,end)\n",
    "        elif(array[middle+1]>ele):\n",
    "            return binary_locate(array,ele,start,middle)\n",
    "        else:\n",
    "            return middle,middle+1\n",
    "    else:\n",
    "        return middle,middle+1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "p = pipes.Template()\n",
    "p.append(\"zcat\", '--')\n",
    "Gene_Loc = defaultdict(list)\n",
    "f = p.open('/home/longy/cnda/ensembl/Homo_sapiens.GRCh38.103.gtf.gz', 'r')\n",
    "\n",
    "#f = p.open('/home/longy/cnda/ensembl/Mus_musculus.GRCm38.102.gtf.gz', 'r')\n",
    "for line in f.readlines():\n",
    "    if re.match('^#',line):\n",
    "        continue\n",
    "    line = line.rstrip('\\n')\n",
    "    data = line.split('\\t')\n",
    "    if(data[2] == 'gene'):\n",
    "        Gene_Loc['chr'+data[0]+data[6]].append(int(data[3]))\n",
    "        Gene_Loc['chr'+data[0]+data[6]].append(int(data[4]))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(1523, 1524)"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import sys\n",
    "sys.setrecursionlimit(10000)\n",
    "array = Gene_Loc['chr1+']\n",
    "binary_locate(array,46104790,0,3505)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file K562_Chen_data/Blocks/chr18_-_0_47986-22172466\n",
      "writing file K562_Chen_data/Blocks/chr18_-_1_22176742-49937405\n",
      "writing file K562_Chen_data/Blocks/chr18_-_2_49944844-80247429\n",
      "writing file K562_Chen_data/Blocks/chr20_-_0_214944-23404208\n",
      "writing file K562_Chen_data/Blocks/chr20_-_1_23411540-35699410\n",
      "writing file K562_Chen_data/Blocks/chr20_-_2_35702169-49283306\n",
      "writing file K562_Chen_data/Blocks/chr20_-_3_49338866-64333153\n",
      "writing file K562_Chen_data/Blocks/chr20_+_0_129983-21391098\n",
      "writing file K562_Chen_data/Blocks/chr20_+_1_21396015-36528643\n",
      "writing file K562_Chen_data/Blocks/chr20_+_2_36535893-50021212\n",
      "writing file K562_Chen_data/Blocks/chr20_+_3_50024280-64329721\n",
      "writing file K562_Chen_data/Blocks/chr2_-_0_39346-20354918\n",
      "writing file K562_Chen_data/Blocks/chr2_-_1_20359201-37324845\n",
      "writing file K562_Chen_data/Blocks/chr2_-_2_37420060-54034208\n",
      "writing file K562_Chen_data/Blocks/chr2_-_3_54035643-65819316\n",
      "writing file K562_Chen_data/Blocks/chr2_-_4_65896898-78293783\n",
      "writing file K562_Chen_data/Blocks/chr2_-_5_78294997-96974580\n",
      "writing file K562_Chen_data/Blocks/chr2_-_6_96977882-111850919\n",
      "writing file K562_Chen_data/Blocks/chr2_-_7_111852340-133263710\n",
      "writing file K562_Chen_data/Blocks/chr2_-_8_133286831-156040129\n",
      "writing file K562_Chen_data/Blocks/chr2_-_9_156044728-171858230\n",
      "writing file K562_Chen_data/Blocks/chr2_-_10_171861284-187647412\n",
      "writing file K562_Chen_data/Blocks/chr2_-_11_187675680-202826860\n",
      "writing file K562_Chen_data/Blocks/chr2_-_12_202827949-227325953\n",
      "writing file K562_Chen_data/Blocks/chr2_-_13_227345644-242180305\n",
      "writing file K562_Chen_data/Blocks/chr5_+_0_50710-21517759\n",
      "writing file K562_Chen_data/Blocks/chr5_+_1_21518881-43207209\n",
      "writing file K562_Chen_data/Blocks/chr5_+_2_43245074-66184032\n",
      "writing file K562_Chen_data/Blocks/chr5_+_3_66187358-82026192\n",
      "writing file K562_Chen_data/Blocks/chr5_+_4_82027835-96944314\n",
      "writing file K562_Chen_data/Blocks/chr5_+_5_96945582-116061439\n",
      "writing file K562_Chen_data/Blocks/chr5_+_6_116062454-134719558\n",
      "writing file K562_Chen_data/Blocks/chr5_+_7_134720990-146511977\n",
      "writing file K562_Chen_data/Blocks/chr5_+_8_146515014-170045944\n",
      "writing file K562_Chen_data/Blocks/chr5_+_9_170047501-181478096\n",
      "writing file K562_Chen_data/Blocks/chr12_+_0_11668-10223138\n",
      "writing file K562_Chen_data/Blocks/chr12_+_1_10241107-28581489\n",
      "writing file K562_Chen_data/Blocks/chr12_+_2_28582728-48348284\n",
      "writing file K562_Chen_data/Blocks/chr12_+_3_48350509-56229879\n",
      "writing file K562_Chen_data/Blocks/chr12_+_4_56231366-69825369\n",
      "writing file K562_Chen_data/Blocks/chr12_+_5_69837333-95889100\n",
      "writing file K562_Chen_data/Blocks/chr12_+_6_95898223-109536718\n",
      "writing file K562_Chen_data/Blocks/chr12_+_7_109544550-122147367\n",
      "writing file K562_Chen_data/Blocks/chr12_+_8_122165184-133225754\n",
      "writing file K562_Chen_data/Blocks/chr17_-_0_61706-7338182\n",
      "writing file K562_Chen_data/Blocks/chr17_-_1_7341699-20903525\n",
      "writing file K562_Chen_data/Blocks/chr17_-_2_20986135-35560855\n",
      "writing file K562_Chen_data/Blocks/chr17_-_3_35563887-43152260\n",
      "writing file K562_Chen_data/Blocks/chr17_-_4_43153703-49837964\n",
      "writing file K562_Chen_data/Blocks/chr17_-_5_49870886-64132922\n",
      "writing file K562_Chen_data/Blocks/chr17_-_6_64140924-76203134\n",
      "writing file K562_Chen_data/Blocks/chr17_-_7_76205381-83241808\n",
      "writing file K562_Chen_data/Blocks/chr6_-_0_67468-15090415\n",
      "writing file K562_Chen_data/Blocks/chr6_-_1_15096803-29636465\n",
      "writing file K562_Chen_data/Blocks/chr6_-_2_29672764-35497098\n",
      "writing file K562_Chen_data/Blocks/chr6_-_3_35509322-52605888\n",
      "writing file K562_Chen_data/Blocks/chr6_-_4_52667539-84756879\n",
      "writing file K562_Chen_data/Blocks/chr6_-_5_84758147-101284107\n",
      "writing file K562_Chen_data/Blocks/chr6_-_6_101355833-119071308\n",
      "writing file K562_Chen_data/Blocks/chr6_-_7_119073506-137955245\n",
      "writing file K562_Chen_data/Blocks/chr6_-_8_137957542-155315492\n",
      "writing file K562_Chen_data/Blocks/chr6_-_9_155364172-170745736\n",
      "writing file K562_Chen_data/Blocks/chr7_-_0_12924-10779993\n",
      "writing file K562_Chen_data/Blocks/chr7_-_1_10783126-24907761\n",
      "writing file K562_Chen_data/Blocks/chr7_-_2_24909627-43890075\n",
      "writing file K562_Chen_data/Blocks/chr7_-_3_43891372-66554846\n",
      "writing file K562_Chen_data/Blocks/chr7_-_4_66556882-87059957\n",
      "writing file K562_Chen_data/Blocks/chr7_-_5_87065227-100336367\n",
      "writing file K562_Chen_data/Blocks/chr7_-_6_100340362-106884445\n",
      "writing file K562_Chen_data/Blocks/chr7_-_7_106885536-119913030\n",
      "writing file K562_Chen_data/Blocks/chr7_-_8_119914447-135510144\n",
      "writing file K562_Chen_data/Blocks/chr7_-_9_135548341-150323743\n",
      "writing file K562_Chen_data/Blocks/chr7_-_10_150329288-159335436\n",
      "writing file K562_Chen_data/Blocks/chrX_-_0_11661-23504743\n",
      "writing file K562_Chen_data/Blocks/chrX_-_1_23662279-51055559\n",
      "writing file K562_Chen_data/Blocks/chrX_-_2_51196793-75156883\n",
      "writing file K562_Chen_data/Blocks/chrX_-_3_75166775-118282091\n",
      "writing file K562_Chen_data/Blocks/chrX_-_4_118283196-135974074\n",
      "writing file K562_Chen_data/Blocks/chrX_-_5_135981313-156028488\n",
      "writing file K562_Chen_data/Blocks/chr1_-_0_13039-7827840\n",
      "writing file K562_Chen_data/Blocks/chr1_-_1_7845117-19252372\n",
      "writing file K562_Chen_data/Blocks/chr1_-_2_19255517-27186987\n",
      "writing file K562_Chen_data/Blocks/chr1_-_3_27200058-36397940\n",
      "writing file K562_Chen_data/Blocks/chr1_-_4_36414337-45703376\n",
      "writing file K562_Chen_data/Blocks/chr1_-_5_45704724-55215378\n",
      "writing file K562_Chen_data/Blocks/chr1_-_6_55221617-77683805\n",
      "writing file K562_Chen_data/Blocks/chr1_-_7_77685091-93847680\n",
      "writing file K562_Chen_data/Blocks/chr1_-_8_93867238-113710483\n",
      "writing file K562_Chen_data/Blocks/chr1_-_9_113711723-145966502\n",
      "writing file K562_Chen_data/Blocks/chr1_-_10_145977399-154891759\n",
      "writing file K562_Chen_data/Blocks/chr1_-_11_154897952-161638316\n",
      "writing file K562_Chen_data/Blocks/chr1_-_12_161672164-179952539\n",
      "writing file K562_Chen_data/Blocks/chr1_-_13_179953581-194933166\n",
      "writing file K562_Chen_data/Blocks/chr1_-_14_194994384-206612546\n",
      "writing file K562_Chen_data/Blocks/chr1_-_15_206634365-225472241\n",
      "writing file K562_Chen_data/Blocks/chr1_-_16_225486506-236281992\n",
      "writing file K562_Chen_data/Blocks/chr1_-_17_236350121-248936826\n",
      "writing file K562_Chen_data/Blocks/chr22_+_0_10685461-21702050\n",
      "writing file K562_Chen_data/Blocks/chr22_+_1_21721523-31287026\n",
      "writing file K562_Chen_data/Blocks/chr22_+_2_31291295-41361791\n",
      "writing file K562_Chen_data/Blocks/chr22_+_3_41362956-50804637\n",
      "writing file K562_Chen_data/Blocks/chr22_-_0_10529077-21014285\n",
      "writing file K562_Chen_data/Blocks/chr22_-_1_21023762-30328956\n",
      "writing file K562_Chen_data/Blocks/chr22_-_2_30331968-40587586\n",
      "writing file K562_Chen_data/Blocks/chr22_-_3_40589422-50804637\n",
      "writing file K562_Chen_data/Blocks/chr8_+_0_67070-20125083\n",
      "writing file K562_Chen_data/Blocks/chr8_+_1_20128290-38122567\n",
      "writing file K562_Chen_data/Blocks/chr8_+_2_38124755-56014879\n",
      "writing file K562_Chen_data/Blocks/chr8_+_3_56021441-88064196\n",
      "writing file K562_Chen_data/Blocks/chr8_+_4_88065801-99604640\n",
      "writing file K562_Chen_data/Blocks/chr8_+_5_99613724-124647551\n",
      "writing file K562_Chen_data/Blocks/chr8_+_6_124654741-145067168\n",
      "writing file K562_Chen_data/Blocks/chr16_+_0_10778-4885319\n",
      "writing file K562_Chen_data/Blocks/chr16_+_1_4888014-20925062\n",
      "writing file K562_Chen_data/Blocks/chr16_+_2_20941251-31105331\n",
      "writing file K562_Chen_data/Blocks/chr16_+_3_31108374-67101081\n",
      "writing file K562_Chen_data/Blocks/chr16_+_4_67109940-78757602\n",
      "writing file K562_Chen_data/Blocks/chr16_+_5_78764678-90228203\n",
      "writing file K562_Chen_data/Blocks/chr4_-_0_34905-13495915\n",
      "writing file K562_Chen_data/Blocks/chr4_-_1_13497212-39973450\n",
      "writing file K562_Chen_data/Blocks/chr4_-_2_39976420-68249204\n",
      "writing file K562_Chen_data/Blocks/chr4_-_3_68255960-82901183\n",
      "writing file K562_Chen_data/Blocks/chr4_-_4_82903526-103198447\n",
      "writing file K562_Chen_data/Blocks/chr4_-_5_103208904-126735864\n",
      "writing file K562_Chen_data/Blocks/chr4_-_6_126737617-144019541\n",
      "writing file K562_Chen_data/Blocks/chr4_-_7_144027665-172102299\n",
      "writing file K562_Chen_data/Blocks/chr4_-_8_172104254-190118373\n",
      "writing file K562_Chen_data/Blocks/chr2_+_0_262621-24130238\n",
      "writing file K562_Chen_data/Blocks/chr2_+_1_24134176-36553199\n",
      "writing file K562_Chen_data/Blocks/chr2_+_2_36555675-48515854\n",
      "writing file K562_Chen_data/Blocks/chr2_+_3_48516909-65633926\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file K562_Chen_data/Blocks/chr2_+_4_65663938-76194408\n",
      "writing file K562_Chen_data/Blocks/chr2_+_5_76195559-99187038\n",
      "writing file K562_Chen_data/Blocks/chr2_+_6_99188158-113520913\n",
      "writing file K562_Chen_data/Blocks/chr2_+_7_113522232-134959355\n",
      "writing file K562_Chen_data/Blocks/chr2_+_8_134965358-157326210\n",
      "writing file K562_Chen_data/Blocks/chr2_+_9_157359081-173270025\n",
      "writing file K562_Chen_data/Blocks/chr2_+_10_173271219-184404077\n",
      "writing file K562_Chen_data/Blocks/chr2_+_11_184408748-198895068\n",
      "writing file K562_Chen_data/Blocks/chr2_+_12_199269438-213931701\n",
      "writing file K562_Chen_data/Blocks/chr2_+_13_214062672-232344588\n",
      "writing file K562_Chen_data/Blocks/chr2_+_14_232347567-242181456\n",
      "writing file K562_Chen_data/Blocks/chr21_+_0_5026510-22503195\n",
      "writing file K562_Chen_data/Blocks/chr21_+_1_22517197-38208638\n",
      "writing file K562_Chen_data/Blocks/chr21_+_2_38210233-46699316\n",
      "writing file K562_Chen_data/Blocks/chr21_-_0_5031890-22127130\n",
      "writing file K562_Chen_data/Blocks/chr21_-_1_22130477-37073939\n",
      "writing file K562_Chen_data/Blocks/chr21_-_2_37087217-46694033\n",
      "writing file K562_Chen_data/Blocks/chr3_+_0_144147-12589028\n",
      "writing file K562_Chen_data/Blocks/chr3_+_1_12590427-23925152\n",
      "writing file K562_Chen_data/Blocks/chr3_+_2_23926804-40470913\n",
      "writing file K562_Chen_data/Blocks/chr3_+_3_40477123-49723857\n",
      "writing file K562_Chen_data/Blocks/chr3_+_4_49727272-70143215\n",
      "writing file K562_Chen_data/Blocks/chr3_+_5_70147969-101597661\n",
      "writing file K562_Chen_data/Blocks/chr3_+_6_101599175-123644691\n",
      "writing file K562_Chen_data/Blocks/chr3_+_7_123645811-137017015\n",
      "writing file K562_Chen_data/Blocks/chr3_+_8_137019322-155863645\n",
      "writing file K562_Chen_data/Blocks/chr3_+_9_155864945-172288093\n",
      "writing file K562_Chen_data/Blocks/chr3_+_10_172292065-187733883\n",
      "writing file K562_Chen_data/Blocks/chr3_+_11_187742750-198230087\n",
      "writing file K562_Chen_data/Blocks/chr18_+_0_37657-12033346\n",
      "writing file K562_Chen_data/Blocks/chr18_+_1_12057251-45752619\n",
      "writing file K562_Chen_data/Blocks/chr18_+_2_45842429-80263074\n",
      "writing file K562_Chen_data/Blocks/chr9_+_0_12621-32326727\n",
      "writing file K562_Chen_data/Blocks/chr9_+_1_32329085-63843200\n",
      "writing file K562_Chen_data/Blocks/chr9_+_2_63845591-88182102\n",
      "writing file K562_Chen_data/Blocks/chr9_+_3_88227616-99159133\n",
      "writing file K562_Chen_data/Blocks/chr9_+_4_99172181-121464506\n",
      "writing file K562_Chen_data/Blocks/chr9_+_5_121466959-130502198\n",
      "writing file K562_Chen_data/Blocks/chr9_+_6_130521093-138334465\n",
      "writing file K562_Chen_data/Blocks/chr11_+_0_123348-9435054\n",
      "writing file K562_Chen_data/Blocks/chr11_+_1_9436221-28516896\n",
      "writing file K562_Chen_data/Blocks/chr11_+_2_28526291-46383845\n",
      "writing file K562_Chen_data/Blocks/chr11_+_3_46385193-64007095\n",
      "writing file K562_Chen_data/Blocks/chr11_+_4_64010403-68459346\n",
      "writing file K562_Chen_data/Blocks/chr11_+_5_68460712-77042422\n",
      "writing file K562_Chen_data/Blocks/chr11_+_6_77047685-99233453\n",
      "writing file K562_Chen_data/Blocks/chr11_+_7_99255030-119093820\n",
      "writing file K562_Chen_data/Blocks/chr11_+_8_119094861-134897563\n",
      "writing file K562_Chen_data/Blocks/chr4_+_0_18799-7061008\n",
      "writing file K562_Chen_data/Blocks/chr4_+_1_7068367-27458231\n",
      "writing file K562_Chen_data/Blocks/chr4_+_2_27460930-53422301\n",
      "writing file K562_Chen_data/Blocks/chr4_+_3_53423888-75815182\n",
      "writing file K562_Chen_data/Blocks/chr4_+_4_75816680-94292490\n",
      "writing file K562_Chen_data/Blocks/chr4_+_5_94297538-112474084\n",
      "writing file K562_Chen_data/Blocks/chr4_+_6_112515399-134584266\n",
      "writing file K562_Chen_data/Blocks/chr4_+_7_134627634-163552162\n",
      "writing file K562_Chen_data/Blocks/chr4_+_8_163555317-190203219\n",
      "writing file K562_Chen_data/Blocks/chr12_-_0_12548-12270948\n",
      "writing file K562_Chen_data/Blocks/chr12_-_1_12309996-29381330\n",
      "writing file K562_Chen_data/Blocks/chr12_-_2_29402625-48957529\n",
      "writing file K562_Chen_data/Blocks/chr12_-_3_48965094-56356586\n",
      "writing file K562_Chen_data/Blocks/chr12_-_4_56358071-74288545\n",
      "writing file K562_Chen_data/Blocks/chr12_-_5_74289594-95553263\n",
      "writing file K562_Chen_data/Blocks/chr12_-_6_95582327-111575183\n",
      "writing file K562_Chen_data/Blocks/chr12_-_7_111579181-123012742\n",
      "writing file K562_Chen_data/Blocks/chr12_-_8_123013806-133258142\n",
      "writing file K562_Chen_data/Blocks/chr7_+_0_20694-12353073\n",
      "writing file K562_Chen_data/Blocks/chr7_+_1_12355257-30412408\n",
      "writing file K562_Chen_data/Blocks/chr7_+_2_30414889-55211985\n",
      "writing file K562_Chen_data/Blocks/chr7_+_3_55213992-75043285\n",
      "writing file K562_Chen_data/Blocks/chr7_+_4_75052694-93362262\n",
      "writing file K562_Chen_data/Blocks/chr7_+_5_93370547-102856255\n",
      "writing file K562_Chen_data/Blocks/chr7_+_6_102915362-121167257\n",
      "writing file K562_Chen_data/Blocks/chr7_+_7_121168912-135694983\n",
      "writing file K562_Chen_data/Blocks/chr7_+_8_135696676-148847484\n",
      "writing file K562_Chen_data/Blocks/chr7_+_9_148850315-159291636\n",
      "writing file K562_Chen_data/Blocks/chr16_-_0_10055-4848130\n",
      "writing file K562_Chen_data/Blocks/chr16_-_1_4852821-19718241\n",
      "writing file K562_Chen_data/Blocks/chr16_-_2_19752471-31400421\n",
      "writing file K562_Chen_data/Blocks/chr16_-_3_31401554-67279446\n",
      "writing file K562_Chen_data/Blocks/chr16_-_4_67286800-78726187\n",
      "writing file K562_Chen_data/Blocks/chr16_-_5_78761400-90228222\n",
      "writing file K562_Chen_data/Blocks/chr6_+_0_142717-14138308\n",
      "writing file K562_Chen_data/Blocks/chr6_+_1_14140366-27906550\n",
      "writing file K562_Chen_data/Blocks/chr6_+_2_27913162-33459924\n",
      "writing file K562_Chen_data/Blocks/chr6_+_3_33525416-42970509\n",
      "writing file K562_Chen_data/Blocks/chr6_+_4_42972508-67151931\n",
      "writing file K562_Chen_data/Blocks/chr6_+_5_67153103-83172809\n",
      "writing file K562_Chen_data/Blocks/chr6_+_6_83174366-111029462\n",
      "writing file K562_Chen_data/Blocks/chr6_+_7_111030821-126220468\n",
      "writing file K562_Chen_data/Blocks/chr6_+_8_126221782-143913502\n",
      "writing file K562_Chen_data/Blocks/chr6_+_9_143926537-157638026\n",
      "writing file K562_Chen_data/Blocks/chr6_+_10_157639197-170745793\n",
      "writing file K562_Chen_data/Blocks/chr15_-_0_17030835-40565151\n",
      "writing file K562_Chen_data/Blocks/chr15_-_1_40569475-50651482\n",
      "writing file K562_Chen_data/Blocks/chr15_-_2_50655018-63833956\n",
      "writing file K562_Chen_data/Blocks/chr15_-_3_63840269-75514903\n",
      "writing file K562_Chen_data/Blocks/chr15_-_4_75517239-87602033\n",
      "writing file K562_Chen_data/Blocks/chr15_-_5_87611818-101977082\n",
      "writing file K562_Chen_data/Blocks/chr13_-_0_18171314-38029500\n",
      "writing file K562_Chen_data/Blocks/chr13_-_1_38030851-52450675\n",
      "writing file K562_Chen_data/Blocks/chr13_-_2_52452018-93283551\n",
      "writing file K562_Chen_data/Blocks/chr13_-_3_93285907-114324788\n",
      "writing file K562_Chen_data/Blocks/chrX_+_0_15190-24745906\n",
      "writing file K562_Chen_data/Blocks/chrX_+_1_24748290-49340139\n",
      "writing file K562_Chen_data/Blocks/chrX_+_2_49341503-74012897\n",
      "writing file K562_Chen_data/Blocks/chrX_+_3_74014785-111766179\n",
      "writing file K562_Chen_data/Blocks/chrX_+_4_111776672-136083410\n",
      "writing file K562_Chen_data/Blocks/chrX_+_5_136147457-156026293\n",
      "writing file K562_Chen_data/Blocks/chr1_+_0_12838-11066272\n",
      "writing file K562_Chen_data/Blocks/chr1_+_1_11067685-22532076\n",
      "writing file K562_Chen_data/Blocks/chr1_+_2_22533772-31635350\n",
      "writing file K562_Chen_data/Blocks/chr1_+_3_31639826-40497264\n",
      "writing file K562_Chen_data/Blocks/chr1_+_4_40502502-51724542\n",
      "writing file K562_Chen_data/Blocks/chr1_+_5_51726319-67688356\n",
      "writing file K562_Chen_data/Blocks/chr1_+_6_67690901-92402165\n",
      "writing file K562_Chen_data/Blocks/chr1_+_7_92404389-110024089\n",
      "writing file K562_Chen_data/Blocks/chr1_+_8_110026050-121149299\n",
      "writing file K562_Chen_data/Blocks/chr1_+_9_121161301-153222311\n",
      "writing file K562_Chen_data/Blocks/chr1_+_10_153225275-162530330\n",
      "writing file K562_Chen_data/Blocks/chr1_+_11_162541586-174877625\n",
      "writing file K562_Chen_data/Blocks/chr1_+_12_174879412-192812395\n",
      "writing file K562_Chen_data/Blocks/chr1_+_13_192857212-206734304\n",
      "writing file K562_Chen_data/Blocks/chr1_+_14_206739242-222669050\n",
      "writing file K562_Chen_data/Blocks/chr1_+_15_222671373-232983892\n",
      "writing file K562_Chen_data/Blocks/chr1_+_16_232986371-248945573\n",
      "writing file K562_Chen_data/Blocks/chr19_-_0_60118-4743578\n",
      "writing file K562_Chen_data/Blocks/chr19_-_1_4748823-11197852\n",
      "writing file K562_Chen_data/Blocks/chr19_-_2_11199306-17863259\n",
      "writing file K562_Chen_data/Blocks/chr19_-_3_17872131-32631503\n",
      "writing file K562_Chen_data/Blocks/chr19_-_4_32632648-40341901\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file K562_Chen_data/Blocks/chr19_-_5_40343383-47231247\n",
      "writing file K562_Chen_data/Blocks/chr19_-_6_47232346-52849940\n",
      "writing file K562_Chen_data/Blocks/chr19_-_7_52851332-58599425\n",
      "writing file K562_Chen_data/Blocks/chr5_-_0_16092-28810847\n",
      "writing file K562_Chen_data/Blocks/chr5_-_1_28876132-50971889\n",
      "writing file K562_Chen_data/Blocks/chr5_-_2_50972960-72316510\n",
      "writing file K562_Chen_data/Blocks/chr5_-_3_72317786-87413022\n",
      "writing file K562_Chen_data/Blocks/chr5_-_4_87431741-108382398\n",
      "writing file K562_Chen_data/Blocks/chr5_-_5_108394257-132813370\n",
      "writing file K562_Chen_data/Blocks/chr5_-_6_132819681-145769919\n",
      "writing file K562_Chen_data/Blocks/chr5_-_7_145771097-172687073\n",
      "writing file K562_Chen_data/Blocks/chr5_-_8_172711960-181470916\n",
      "writing file K562_Chen_data/Blocks/chr10_-_0_55470-16729029\n",
      "writing file K562_Chen_data/Blocks/chr10_-_1_16730599-33038097\n",
      "writing file K562_Chen_data/Blocks/chr10_-_2_33071213-60786823\n",
      "writing file K562_Chen_data/Blocks/chr10_-_3_60788058-74151080\n",
      "writing file K562_Chen_data/Blocks/chr10_-_4_74172147-96000990\n",
      "writing file K562_Chen_data/Blocks/chr10_-_5_96002887-112447585\n",
      "writing file K562_Chen_data/Blocks/chr10_-_6_112536322-133770304\n",
      "writing file K562_Chen_data/Blocks/chr19_+_0_71016-6714516\n",
      "writing file K562_Chen_data/Blocks/chr19_+_1_6731257-13090410\n",
      "writing file K562_Chen_data/Blocks/chr19_+_2_13093845-19964897\n",
      "writing file K562_Chen_data/Blocks/chr19_+_3_19976849-35553560\n",
      "writing file K562_Chen_data/Blocks/chr19_+_4_35556744-41831018\n",
      "writing file K562_Chen_data/Blocks/chr19_+_5_41843494-48482670\n",
      "writing file K562_Chen_data/Blocks/chr19_+_6_48483723-54101509\n",
      "writing file K562_Chen_data/Blocks/chr19_+_7_54102775-58605506\n",
      "writing file K562_Chen_data/Blocks/chr3_-_0_376269-15775682\n",
      "writing file K562_Chen_data/Blocks/chr3_-_1_15782665-40313757\n",
      "writing file K562_Chen_data/Blocks/chr3_-_2_40315999-49166333\n",
      "writing file K562_Chen_data/Blocks/chr3_-_3_49172678-64843873\n",
      "writing file K562_Chen_data/Blocks/chr3_-_4_65032971-101457738\n",
      "writing file K562_Chen_data/Blocks/chr3_-_5_101458933-121750044\n",
      "writing file K562_Chen_data/Blocks/chr3_-_6_121769419-134250869\n",
      "writing file K562_Chen_data/Blocks/chr3_-_7_134329975-155834937\n",
      "writing file K562_Chen_data/Blocks/chr3_-_8_155835986-178944731\n",
      "writing file K562_Chen_data/Blocks/chr3_-_9_178946644-193871323\n",
      "writing file K562_Chen_data/Blocks/chr3_-_10_193872521-198217563\n",
      "writing file K562_Chen_data/Blocks/chr9_-_0_13011-22030104\n",
      "writing file K562_Chen_data/Blocks/chr9_-_1_22031886-63859670\n",
      "writing file K562_Chen_data/Blocks/chr9_-_2_63872189-91361957\n",
      "writing file K562_Chen_data/Blocks/chr9_-_3_91392880-100010253\n",
      "writing file K562_Chen_data/Blocks/chr9_-_4_100014160-121646576\n",
      "writing file K562_Chen_data/Blocks/chr9_-_5_121651883-131726575\n",
      "writing file K562_Chen_data/Blocks/chr9_-_6_131731782-138269677\n",
      "writing file K562_Chen_data/Blocks/chr8_-_0_61205-22920965\n",
      "writing file K562_Chen_data/Blocks/chr8_-_1_22926563-46846128\n",
      "writing file K562_Chen_data/Blocks/chr8_-_2_46921487-72130662\n",
      "writing file K562_Chen_data/Blocks/chr8_-_3_72136676-93741101\n",
      "writing file K562_Chen_data/Blocks/chr8_-_4_93762666-110939387\n",
      "writing file K562_Chen_data/Blocks/chr8_-_5_110941103-129554949\n",
      "writing file K562_Chen_data/Blocks/chr8_-_6_129557063-145053154\n",
      "writing file K562_Chen_data/Blocks/chr11_-_0_67430-6483156\n",
      "writing file K562_Chen_data/Blocks/chr11_-_1_6489205-18053710\n",
      "writing file K562_Chen_data/Blocks/chr11_-_2_18054910-38315560\n",
      "writing file K562_Chen_data/Blocks/chr11_-_3_38316670-62673470\n",
      "writing file K562_Chen_data/Blocks/chr11_-_4_62676244-68855846\n",
      "writing file K562_Chen_data/Blocks/chr11_-_5_68865355-77866734\n",
      "writing file K562_Chen_data/Blocks/chr11_-_6_77868957-96411692\n",
      "writing file K562_Chen_data/Blocks/chr11_-_7_96421092-117035886\n",
      "writing file K562_Chen_data/Blocks/chr11_-_8_117038809-135056647\n",
      "writing file K562_Chen_data/Blocks/chr13_+_0_18171241-38363686\n",
      "writing file K562_Chen_data/Blocks/chr13_+_1_38365074-52592684\n",
      "writing file K562_Chen_data/Blocks/chr13_+_2_52601894-97394140\n",
      "writing file K562_Chen_data/Blocks/chr13_+_3_97398977-114349135\n",
      "writing file K562_Chen_data/Blocks/chr17_+_0_65481-14349378\n",
      "writing file K562_Chen_data/Blocks/chr17_+_1_14355390-22442063\n",
      "writing file K562_Chen_data/Blocks/chr17_+_2_22449861-32950903\n",
      "writing file K562_Chen_data/Blocks/chr17_+_3_32962207-42549674\n",
      "writing file K562_Chen_data/Blocks/chr17_+_4_42551019-49042408\n",
      "writing file K562_Chen_data/Blocks/chr17_+_5_49043420-62239190\n",
      "writing file K562_Chen_data/Blocks/chr17_+_6_62242939-76485678\n",
      "writing file K562_Chen_data/Blocks/chr17_+_7_76518500-83244918\n",
      "writing file K562_Chen_data/Blocks/chr14_-_0_16024021-30722546\n",
      "writing file K562_Chen_data/Blocks/chr14_-_1_30734930-52552586\n",
      "writing file K562_Chen_data/Blocks/chr14_-_2_52639940-68816807\n",
      "writing file K562_Chen_data/Blocks/chr14_-_3_68821725-91064980\n",
      "writing file K562_Chen_data/Blocks/chr14_-_4_91114159-106839426\n",
      "writing file K562_Chen_data/Blocks/chr15_+_0_17010530-40470071\n",
      "writing file K562_Chen_data/Blocks/chr15_+_1_40471099-50229805\n",
      "writing file K562_Chen_data/Blocks/chr15_+_2_50231053-65850977\n",
      "writing file K562_Chen_data/Blocks/chr15_+_3_65858568-77509263\n",
      "writing file K562_Chen_data/Blocks/chr15_+_4_77517268-89737798\n",
      "writing file K562_Chen_data/Blocks/chr15_+_5_89743609-101976501\n",
      "writing file K562_Chen_data/Blocks/chr14_+_0_16035720-34552227\n",
      "writing file K562_Chen_data/Blocks/chr14_+_1_34562860-57415923\n",
      "writing file K562_Chen_data/Blocks/chr14_+_2_57419761-73275917\n",
      "writing file K562_Chen_data/Blocks/chr14_+_3_73278601-96567136\n"
     ]
    }
   ],
   "source": [
    "total = 0\n",
    "files = glob.glob(root_dir+\"/*.txt\")\n",
    "info = open(root_dir+'/Blocks/info.txt','w')\n",
    "info.write('ID\\tstart\\tend\\tlength\\tsites_num\\n')\n",
    "for file in files:\n",
    "    num_lines = sum(1 for line in open(file))\n",
    "    num_blocks = round(num_lines/Fixed_length)\n",
    "    len_blocks = num_lines/num_blocks\n",
    "    \n",
    "    f= open(file,'r')\n",
    "    pre_pos = 0\n",
    "    dict_line = OrderedDict()\n",
    "    #dict_line = dict()\n",
    "    count = 0\n",
    "    separate_num=0\n",
    "    save_block = 0\n",
    "    start = 0\n",
    "    \n",
    "    for i, line in enumerate(f):\n",
    "        line = line.rstrip('\\n')\n",
    "        if(i==0):\n",
    "            continue ###Skip header\n",
    "        chromosome,pos,strand = line.split('\\t')[0].split(':')\n",
    "        pos = int(pos)\n",
    "        count += 1\n",
    "        if(i==1):\n",
    "            start=pos\n",
    "        if(count>len_blocks and pos-pre_pos>1000 and save_block<num_blocks-1):\n",
    "            array = Gene_Loc[chromosome+strand]\n",
    "            index1,index2 = binary_locate(array,pre_pos,0,len(array)-1)\n",
    "            if(index1%2==1 and index2%2==0):\n",
    "                ww = open(root_dir+'/Blocks/%s_%s_%d'%(chromosome,strand,save_block),'w')\n",
    "                print('writing file '+root_dir+'/Blocks/%s_%s_%d_%d-%d'%(chromosome,strand,save_block,start,pre_pos))\n",
    "                info.write('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "                #print('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "                for key,val in dict_line.items():\n",
    "                    ww.write('%s\\n'%val)\n",
    "                ww.close()\n",
    "                dict_line.clear()\n",
    "                count = 0\n",
    "                save_block += 1\n",
    "                start  = pos\n",
    "            \n",
    "        \n",
    "        dict_line[pos] = line\n",
    "        pre_pos = pos\n",
    "        \n",
    "    out = open(root_dir+'/Blocks/%s_%s_%d'%(chromosome,strand,save_block),'w')\n",
    "    print('writing file '+root_dir+'/Blocks/%s_%s_%d_%d-%d'%(chromosome,strand,save_block,start,pre_pos))\n",
    "    info.write('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "    for key,val in dict_line.items():\n",
    "        out.write('%s\\n'%(val))\n",
    "    out.close()\n",
    "\n",
    "info.close()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
