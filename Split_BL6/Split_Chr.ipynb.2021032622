{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import glob\n",
    "from collections import OrderedDict,defaultdict\n",
    "import pipes\n",
    "import pprint\n",
    "import tempfile\n",
    "import re"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "root_dir = 'HepG2_ETF1_data'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "####Fixed length 1e6 = 100 blocks. \n",
    "####Fixed length 5e5 = 200 blocks. \n",
    "Fixed_length = 2e6"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "def binary_locate(array,ele,start,end):\n",
    "    middle = (end+start)//2\n",
    "    if(end-start>1):\n",
    "        if(array[middle]<ele):\n",
    "            return binary_locate(array,ele,middle,end)\n",
    "        elif(array[middle+1]>ele):\n",
    "            return binary_locate(array,ele,start,middle)\n",
    "        else:\n",
    "            return middle,middle+1\n",
    "    else:\n",
    "        return middle,middle+1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "p = pipes.Template()\n",
    "p.append(\"zcat\", '--')\n",
    "Gene_Loc = defaultdict(list)\n",
    "f = p.open('/home/longy/cnda/ensembl/Homo_sapiens.GRCh38.102.gtf.gz', 'r')\n",
    "\n",
    "#f = p.open('/home/longy/cnda/ensembl/Mus_musculus.GRCm38.102.gtf.gz', 'r')\n",
    "for line in f.readlines():\n",
    "    if re.match('^#',line):\n",
    "        continue\n",
    "    line = line.rstrip('\\n')\n",
    "    data = line.split('\\t')\n",
    "    if(data[2] == 'gene'):\n",
    "        Gene_Loc['chr'+data[0]+data[6]].append(int(data[3]))\n",
    "        Gene_Loc['chr'+data[0]+data[6]].append(int(data[4]))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(1527, 1528)"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import sys\n",
    "sys.setrecursionlimit(10000)\n",
    "array = Gene_Loc['chr1+']\n",
    "binary_locate(array,46104790,0,3505)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file HepG2_ETF1_data/Blocks/chr5_+_0_181595-43525734\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_+_1_43527322-71658909\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_+_2_71662019-88386968\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_+_3_88389513-113603308\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_+_4_113604309-138437943\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_+_5_138439146-154349163\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_+_6_154355228-181476095\n",
      "writing file HepG2_ETF1_data/Blocks/chr21_+_0_5026292-37175733\n",
      "writing file HepG2_ETF1_data/Blocks/chr21_+_1_37176864-46696461\n",
      "writing file HepG2_ETF1_data/Blocks/chr20_-_0_269336-17682455\n",
      "writing file HepG2_ETF1_data/Blocks/chr20_-_1_17691203-35412562\n",
      "writing file HepG2_ETF1_data/Blocks/chr20_-_2_35422606-47973515\n",
      "writing file HepG2_ETF1_data/Blocks/chr20_-_3_47976728-64326413\n",
      "writing file HepG2_ETF1_data/Blocks/chr20_+_0_191283-13822908\n",
      "writing file HepG2_ETF1_data/Blocks/chr20_+_1_13832204-34544989\n",
      "writing file HepG2_ETF1_data/Blocks/chr20_+_2_34551778-46736369\n",
      "writing file HepG2_ETF1_data/Blocks/chr20_+_3_46780404-64311365\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_0_11797-11853476\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_1_11855682-26947249\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_2_26948593-39489645\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_3_39490649-52827374\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_4_52854568-78607860\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_5_78609654-103577917\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_6_103579198-146997498\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_7_147051047-161426920\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_8_161430013-179556538\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_9_179559796-207387495\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_10_207388655-227679726\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_+_11_227681415-248942380\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_+_0_11034-8870049\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_+_1_8871114-22290171\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_+_2_22292560-48242170\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_+_3_48243498-67890121\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_+_4_67891344-78899815\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_+_5_78900984-90228026\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_+_0_53397-16307945\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_+_1_16310213-56465909\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_+_2_56467592-78920764\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_+_3_78921868-112412906\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_+_4_112414035-145559248\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_+_5_145561278-190199837\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_-_0_10532-22474879\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_-_1_22476572-48673690\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_-_2_48674968-64759457\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_-_3_65055183-100201015\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_-_4_100202049-117191232\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_-_5_117265882-133207730\n",
      "writing file HepG2_ETF1_data/Blocks/chr22_-_0_10671059-28320547\n",
      "writing file HepG2_ETF1_data/Blocks/chr22_-_1_28322293-38274053\n",
      "writing file HepG2_ETF1_data/Blocks/chr22_-_2_38278909-50798649\n",
      "writing file HepG2_ETF1_data/Blocks/chr13_+_0_18184129-45442260\n",
      "writing file HepG2_ETF1_data/Blocks/chr13_+_1_45464908-94410109\n",
      "writing file HepG2_ETF1_data/Blocks/chr13_+_2_94412797-114350572\n",
      "writing file HepG2_ETF1_data/Blocks/chr13_-_0_18177768-40531535\n",
      "writing file HepG2_ETF1_data/Blocks/chr13_-_1_40532732-52458375\n",
      "writing file HepG2_ETF1_data/Blocks/chr13_-_2_52460961-114341662\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_-_0_89041-13712476\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_-_1_13715414-30717889\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_-_2_30720035-43562653\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_-_3_43564475-78867375\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_-_4_78877468-107464498\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_-_5_107470538-129397713\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_-_6_129398860-146542495\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_-_7_146543934-170612600\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_+_0_71560-14616464\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_+_1_14617845-30472422\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_+_2_30476138-41064228\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_+_3_41066222-50496861\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_+_4_50498048-63711102\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_+_5_63712681-77165314\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_+_6_77167657-83246814\n",
      "writing file HepG2_ETF1_data/Blocks/chr14_-_0_16048699-35865749\n",
      "writing file HepG2_ETF1_data/Blocks/chr14_-_1_35867834-64505232\n",
      "writing file HepG2_ETF1_data/Blocks/chr14_-_2_64510391-88002220\n",
      "writing file HepG2_ETF1_data/Blocks/chr14_-_3_88007428-106869039\n",
      "writing file HepG2_ETF1_data/Blocks/chr15_-_0_19822929-42201810\n",
      "writing file HepG2_ETF1_data/Blocks/chr15_-_1_42204173-55405722\n",
      "writing file HepG2_ETF1_data/Blocks/chr15_-_2_55407775-66893295\n",
      "writing file HepG2_ETF1_data/Blocks/chr15_-_3_66894506-80428672\n",
      "writing file HepG2_ETF1_data/Blocks/chr15_-_4_80433981-101975153\n",
      "writing file HepG2_ETF1_data/Blocks/chr8_-_0_60811-29350691\n",
      "writing file HepG2_ETF1_data/Blocks/chr8_-_1_29422230-66426163\n",
      "writing file HepG2_ETF1_data/Blocks/chr8_-_2_66428870-98718083\n",
      "writing file HepG2_ETF1_data/Blocks/chr8_-_3_98719577-127219787\n",
      "writing file HepG2_ETF1_data/Blocks/chr8_-_4_127228943-145078281\n",
      "writing file HepG2_ETF1_data/Blocks/chrX_+_0_19656-41239064\n",
      "writing file HepG2_ETF1_data/Blocks/chrX_+_1_41241080-70039530\n",
      "writing file HepG2_ETF1_data/Blocks/chrX_+_2_70055919-118806961\n",
      "writing file HepG2_ETF1_data/Blocks/chrX_+_3_118808536-156025559\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_+_0_29816-31997391\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_+_1_31998467-65739824\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_+_2_65745881-94057433\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_+_3_94059282-112669434\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_+_4_112671447-128544434\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_+_5_128552198-138286485\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_-_0_12291-23471852\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_-_1_23473029-44490901\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_-_2_44511134-74657358\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_-_3_74690903-94669645\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_-_4_94675930-105015097\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_-_5_105074709-127393747\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_-_6_127408709-148374524\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_-_7_148376302-159331941\n",
      "writing file HepG2_ETF1_data/Blocks/chr21_-_0_5010997-46689445\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_0_10428-10434803\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_1_10439102-23484599\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_2_23504460-37477064\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_3_37479209-50970087\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_4_50974209-74208053\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_5_74347660-94762145\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_6_94763926-143420631\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_7_143421729-155689543\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_8_155691971-178037953\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_9_178057391-206035808\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_10_206056445-229931738\n",
      "writing file HepG2_ETF1_data/Blocks/chr1_-_11_230099473-248904951\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_+_0_20542-23928045\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_+_1_23945363-44665294\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_+_2_44667687-58300199\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_+_3_58301324-105579382\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_+_4_105589908-128875490\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_+_5_128879624-150586865\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_+_6_150603185-181146959\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_+_7_181155492-198232726\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_+_0_13361-12840257\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_+_1_12841608-45432423\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_+_2_45439687-56321039\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_+_3_56322932-71477501\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_+_4_71479208-101939362\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file HepG2_ETF1_data/Blocks/chr12_+_5_101942205-118162099\n",
      "writing file HepG2_ETF1_data/Blocks/chr12_+_6_118172469-133214618\n",
      "writing file HepG2_ETF1_data/Blocks/chr15_+_0_19819801-43804416\n",
      "writing file HepG2_ETF1_data/Blocks/chr15_+_1_43809815-64697603\n",
      "writing file HepG2_ETF1_data/Blocks/chr15_+_2_64699240-80328303\n",
      "writing file HepG2_ETF1_data/Blocks/chr15_+_3_80428118-101980280\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_0_29236-20875494\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_1_20906436-39056854\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_2_39058229-58047455\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_3_58048755-72859563\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_4_72865999-86656054\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_5_86658300-111255362\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_6_111257045-138086658\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_7_138087693-166128020\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_8_166131850-185732278\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_9_185733838-202334066\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_10_202338226-227325944\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_-_11_227327903-242114612\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_-_0_104798-39170098\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_-_1_39201790-73626475\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_-_2_73636945-95962287\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_-_3_95986505-132669357\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_-_4_132672324-151224118\n",
      "writing file HepG2_ETF1_data/Blocks/chr5_-_5_151240649-181322874\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_-_0_14424-33025114\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_-_1_33026886-71824746\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_-_2_71826453-96147852\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_-_3_96181578-113231782\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_-_4_113234995-128324322\n",
      "writing file HepG2_ETF1_data/Blocks/chr9_-_5_128337093-138185043\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_-_0_47951-27088770\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_-_1_27089772-48303072\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_-_2_48318672-73372557\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_-_3_73373995-95596835\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_-_4_95603512-110919357\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_-_5_110936539-133510823\n",
      "writing file HepG2_ETF1_data/Blocks/chr22_+_0_10566919-27942432\n",
      "writing file HepG2_ETF1_data/Blocks/chr22_+_1_27949885-40389385\n",
      "writing file HepG2_ETF1_data/Blocks/chr22_+_2_40390694-50804796\n",
      "writing file HepG2_ETF1_data/Blocks/chr18_+_0_106260-22993943\n",
      "writing file HepG2_ETF1_data/Blocks/chr18_+_1_22995403-54324128\n",
      "writing file HepG2_ETF1_data/Blocks/chr18_+_2_54326926-80255917\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_+_0_130710-18481900\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_+_1_18489003-47330103\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_+_2_47355274-66544469\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_+_3_66547040-77026833\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_+_4_77039291-111706756\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_+_5_111712221-134961252\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_+_0_196276-17557807\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_+_1_17561364-33306843\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_+_2_33308489-44156163\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_+_3_44157983-85497120\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_+_4_85498243-116506687\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_+_5_116527309-141816687\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_+_6_141818630-156980803\n",
      "writing file HepG2_ETF1_data/Blocks/chr6_+_7_156981881-170744282\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_-_0_102464-14644705\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_-_1_14646563-47541179\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_-_2_47542308-67641208\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_-_3_67642509-77929779\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_-_4_77933988-112080729\n",
      "writing file HepG2_ETF1_data/Blocks/chr11_-_5_112082136-134949081\n",
      "writing file HepG2_ETF1_data/Blocks/chrX_-_0_14451-27219560\n",
      "writing file HepG2_ETF1_data/Blocks/chrX_-_1_27220957-57123830\n",
      "writing file HepG2_ETF1_data/Blocks/chrX_-_2_57133061-103437754\n",
      "writing file HepG2_ETF1_data/Blocks/chrX_-_3_103443289-131797917\n",
      "writing file HepG2_ETF1_data/Blocks/chrX_-_4_131799553-156025356\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_-_0_26055-16085558\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_-_1_16090832-55398165\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_-_2_55411542-86936442\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_-_3_86949477-118685382\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_-_4_118697187-152491001\n",
      "writing file HepG2_ETF1_data/Blocks/chr4_-_5_152493769-190178784\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_-_0_9965-11853435\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_-_1_11857601-28516038\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_-_2_28517122-58001212\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_-_3_58010011-75061881\n",
      "writing file HepG2_ETF1_data/Blocks/chr16_-_4_75085685-90202973\n",
      "writing file HepG2_ETF1_data/Blocks/chr8_+_0_192134-23575529\n",
      "writing file HepG2_ETF1_data/Blocks/chr8_+_1_23578670-47528624\n",
      "writing file HepG2_ETF1_data/Blocks/chr8_+_2_47531309-86487568\n",
      "writing file HepG2_ETF1_data/Blocks/chr8_+_3_86489078-123132104\n",
      "writing file HepG2_ETF1_data/Blocks/chr8_+_4_123133249-145070783\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_+_0_117510-8439986\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_+_1_8441302-17254660\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_+_2_17256019-34480594\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_+_3_34482384-43877116\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_+_4_43878192-50474637\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_+_5_50500124-58605037\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_+_0_180474-23170813\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_+_1_23171919-44071555\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_+_2_44077423-74789715\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_+_3_74831296-97186863\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_+_4_97188210-107975379\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_+_5_107976917-138598832\n",
      "writing file HepG2_ETF1_data/Blocks/chr7_+_6_138600681-159304391\n",
      "writing file HepG2_ETF1_data/Blocks/chr18_-_0_47181-35409023\n",
      "writing file HepG2_ETF1_data/Blocks/chr18_-_1_35415680-80247396\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_-_0_186965-17708050\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_-_1_17709117-43638847\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_-_2_43642449-52981341\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_-_3_52987237-75658983\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_-_4_75670388-115567307\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_-_5_115568684-129183946\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_-_6_129208174-149659126\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_-_7_149660751-185156090\n",
      "writing file HepG2_ETF1_data/Blocks/chr3_-_8_185167255-198152781\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_0_45891-24201021\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_1_24202817-38071372\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_2_38073230-54274070\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_3_54275965-70288264\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_4_70289362-94266527\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_5_94268086-112040676\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_6_112044425-134962404\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_7_134964264-159803137\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_8_159804899-177571881\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_9_177573126-200009538\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_10_200010569-215393275\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_11_215394540-232920657\n",
      "writing file HepG2_ETF1_data/Blocks/chr2_+_12_232921711-242180269\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_+_0_75554-28624666\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_+_1_28626843-63625174\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_+_2_63630188-76103217\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_+_3_76104783-97624510\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_+_4_97627104-114928252\n",
      "writing file HepG2_ETF1_data/Blocks/chr10_+_5_114938172-133786781\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_-_0_60216-7252462\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_-_1_7258537-27331391\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_-_2_27334994-40501644\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file HepG2_ETF1_data/Blocks/chr17_-_3_40532207-47181628\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_-_4_47182782-63781495\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_-_5_63786962-76106992\n",
      "writing file HepG2_ETF1_data/Blocks/chr17_-_6_76108088-83232318\n",
      "writing file HepG2_ETF1_data/Blocks/chr14_+_0_18359699-37554415\n",
      "writing file HepG2_ETF1_data/Blocks/chr14_+_1_37557002-56656034\n",
      "writing file HepG2_ETF1_data/Blocks/chr14_+_2_56657286-71119187\n",
      "writing file HepG2_ETF1_data/Blocks/chr14_+_3_71120551-92707268\n",
      "writing file HepG2_ETF1_data/Blocks/chr14_+_4_92713870-106883064\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_-_0_60374-7505764\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_-_1_7512216-17288477\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_-_2_17291046-37726201\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_-_3_37727625-48513942\n",
      "writing file HepG2_ETF1_data/Blocks/chr19_-_4_48564666-58597681\n"
     ]
    }
   ],
   "source": [
    "total = 0\n",
    "files = glob.glob(root_dir+\"/*.txt\")\n",
    "info = open(root_dir+'/Blocks/info.txt','w')\n",
    "info.write('ID\\tstart\\tend\\tlength\\tsites_num\\n')\n",
    "for file in files:\n",
    "    num_lines = sum(1 for line in open(file))\n",
    "    num_blocks = round(num_lines/Fixed_length)\n",
    "    len_blocks = num_lines/num_blocks\n",
    "    \n",
    "    f= open(file,'r')\n",
    "    pre_pos = 0\n",
    "    dict_line = OrderedDict()\n",
    "    #dict_line = dict()\n",
    "    count = 0\n",
    "    separate_num=0\n",
    "    save_block = 0\n",
    "    start = 0\n",
    "    \n",
    "    for i, line in enumerate(f):\n",
    "        line = line.rstrip('\\n')\n",
    "        if(i==0):\n",
    "            continue ###Skip header\n",
    "        chromosome,pos,strand = line.split('\\t')[0].split(':')\n",
    "        pos = int(pos)\n",
    "        count += 1\n",
    "        if(i==1):\n",
    "            start=pos\n",
    "        if(count>len_blocks and pos-pre_pos>1000 and save_block<num_blocks-1):\n",
    "            array = Gene_Loc[chromosome+strand]\n",
    "            index1,index2 = binary_locate(array,pre_pos,0,len(array)-1)\n",
    "            if(index1%2==1 and index2%2==0):\n",
    "                ww = open(root_dir+'/Blocks/%s_%s_%d'%(chromosome,strand,save_block),'w')\n",
    "                print('writing file '+root_dir+'/Blocks/%s_%s_%d_%d-%d'%(chromosome,strand,save_block,start,pre_pos))\n",
    "                info.write('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "                #print('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "                for key,val in dict_line.items():\n",
    "                    ww.write('%s\\n'%val)\n",
    "                ww.close()\n",
    "                dict_line.clear()\n",
    "                count = 0\n",
    "                save_block += 1\n",
    "                start  = pos\n",
    "            \n",
    "        \n",
    "        dict_line[pos] = line\n",
    "        pre_pos = pos\n",
    "        \n",
    "    out = open(root_dir+'/Blocks/%s_%s_%d'%(chromosome,strand,save_block),'w')\n",
    "    print('writing file '+root_dir+'/Blocks/%s_%s_%d_%d-%d'%(chromosome,strand,save_block,start,pre_pos))\n",
    "    info.write('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "    for key,val in dict_line.items():\n",
    "        out.write('%s\\n'%(val))\n",
    "    out.close()\n",
    "\n",
    "info.close()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
