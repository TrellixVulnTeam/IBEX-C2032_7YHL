{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import glob\n",
    "from collections import OrderedDict,defaultdict\n",
    "import pipes\n",
    "import pprint\n",
    "import tempfile\n",
    "import re"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "root_dir = 'BL6_REP1_data'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [],
   "source": [
    "####Fixed length 1e6 = 100 blocks. \n",
    "####Fixed length 5e5 = 200 blocks. \n",
    "Fixed_length = 2e6"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "def binary_locate(array,ele,start,end):\n",
    "    middle = (end+start)//2\n",
    "    if(end-start>1):\n",
    "        if(array[middle]<ele):\n",
    "            return binary_locate(array,ele,middle,end)\n",
    "        elif(array[middle+1]>ele):\n",
    "            return binary_locate(array,ele,start,middle)\n",
    "        else:\n",
    "            return middle,middle+1\n",
    "    else:\n",
    "        return middle,middle+1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "p = pipes.Template()\n",
    "p.append(\"zcat\", '--')\n",
    "Gene_Loc = defaultdict(list)\n",
    "#f = p.open('/home/longy/cnda/ensembl/Homo_sapiens.GRCh38.102.gtf.gz', 'r')\n",
    "\n",
    "f = p.open('/home/longy/cnda/ensembl/Mus_musculus.GRCm38.102.gtf.gz', 'r')\n",
    "for line in f.readlines():\n",
    "    if re.match('^#',line):\n",
    "        continue\n",
    "    line = line.rstrip('\\n')\n",
    "    data = line.split('\\t')\n",
    "    if(data[2] == 'gene'):\n",
    "        Gene_Loc['chr'+data[0]+data[6]].append(int(data[3]))\n",
    "        Gene_Loc['chr'+data[0]+data[6]].append(int(data[4]))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(678, 679)"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import sys\n",
    "sys.setrecursionlimit(10000)\n",
    "array = Gene_Loc['chr1+']\n",
    "binary_locate(array,46104790,0,3505)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file BL6_REP1_data/Blocks/chr19_-_0_3033453-8872275\n",
      "writing file BL6_REP1_data/Blocks/chr19_-_1_8873442-31765086\n",
      "writing file BL6_REP1_data/Blocks/chr19_-_2_31925511-45789558\n",
      "writing file BL6_REP1_data/Blocks/chr19_-_3_45790885-61323291\n",
      "writing file BL6_REP1_data/Blocks/chr18_-_0_3002376-23987281\n",
      "writing file BL6_REP1_data/Blocks/chr18_-_1_23993589-46325128\n",
      "writing file BL6_REP1_data/Blocks/chr18_-_2_46328762-68291315\n",
      "writing file BL6_REP1_data/Blocks/chr18_-_3_68292467-90591630\n",
      "writing file BL6_REP1_data/Blocks/chr9_-_0_3002650-31211843\n",
      "writing file BL6_REP1_data/Blocks/chr9_-_1_31261325-49800229\n",
      "writing file BL6_REP1_data/Blocks/chr9_-_2_49804471-61948063\n",
      "writing file BL6_REP1_data/Blocks/chr9_-_3_61954452-72061930\n",
      "writing file BL6_REP1_data/Blocks/chr9_-_4_72063035-97133755\n",
      "writing file BL6_REP1_data/Blocks/chr9_-_5_97138049-111655357\n",
      "writing file BL6_REP1_data/Blocks/chr9_-_6_111656884-124494485\n",
      "writing file BL6_REP1_data/Blocks/chr15_-_0_3167182-36222664\n",
      "writing file BL6_REP1_data/Blocks/chr15_-_1_36223765-64061617\n",
      "writing file BL6_REP1_data/Blocks/chr15_-_2_64063235-77842562\n",
      "writing file BL6_REP1_data/Blocks/chr15_-_3_77848700-91235492\n",
      "writing file BL6_REP1_data/Blocks/chr15_-_4_91248113-103901353\n",
      "writing file BL6_REP1_data/Blocks/chr16_+_0_3042517-17090117\n",
      "writing file BL6_REP1_data/Blocks/chr16_+_1_17091204-25433509\n",
      "writing file BL6_REP1_data/Blocks/chr16_+_2_25434853-37102427\n",
      "writing file BL6_REP1_data/Blocks/chr16_+_3_37104746-59501146\n",
      "writing file BL6_REP1_data/Blocks/chr16_+_4_59503182-98102969\n",
      "writing file BL6_REP1_data/Blocks/chr7_-_0_3013326-25789349\n",
      "writing file BL6_REP1_data/Blocks/chr7_-_1_25791840-42517955\n",
      "writing file BL6_REP1_data/Blocks/chr7_-_2_42527031-67315498\n",
      "writing file BL6_REP1_data/Blocks/chr7_-_3_67316718-84087966\n",
      "writing file BL6_REP1_data/Blocks/chr7_-_4_84089809-102210220\n",
      "writing file BL6_REP1_data/Blocks/chr7_-_5_102214054-119901481\n",
      "writing file BL6_REP1_data/Blocks/chr7_-_6_119904894-133124311\n",
      "writing file BL6_REP1_data/Blocks/chr7_-_7_133185987-145339940\n",
      "writing file BL6_REP1_data/Blocks/chr10_-_0_3140463-23324067\n",
      "writing file BL6_REP1_data/Blocks/chr10_-_1_23325414-53351399\n",
      "writing file BL6_REP1_data/Blocks/chr10_-_2_53352657-76346009\n",
      "writing file BL6_REP1_data/Blocks/chr10_-_3_76347344-84534268\n",
      "writing file BL6_REP1_data/Blocks/chr10_-_4_84546642-117150387\n",
      "writing file BL6_REP1_data/Blocks/chr10_-_5_117154779-130592799\n",
      "writing file BL6_REP1_data/Blocks/chr8_+_0_3118927-25113261\n",
      "writing file BL6_REP1_data/Blocks/chr8_+_1_25128700-56598507\n",
      "writing file BL6_REP1_data/Blocks/chr8_+_2_56599869-79202081\n",
      "writing file BL6_REP1_data/Blocks/chr8_+_3_79203544-94068133\n",
      "writing file BL6_REP1_data/Blocks/chr8_+_4_94069225-109574759\n",
      "writing file BL6_REP1_data/Blocks/chr8_+_5_109576904-121063308\n",
      "writing file BL6_REP1_data/Blocks/chr8_+_6_121068865-129294159\n",
      "writing file BL6_REP1_data/Blocks/chr2_+_0_3118375-27248998\n",
      "writing file BL6_REP1_data/Blocks/chr2_+_1_27262330-32256089\n",
      "writing file BL6_REP1_data/Blocks/chr2_+_2_32258102-59857323\n",
      "writing file BL6_REP1_data/Blocks/chr2_+_3_59858470-84835197\n",
      "writing file BL6_REP1_data/Blocks/chr2_+_4_84836373-117205985\n",
      "writing file BL6_REP1_data/Blocks/chr2_+_5_117207615-128897866\n",
      "writing file BL6_REP1_data/Blocks/chr2_+_6_128901277-152721994\n",
      "writing file BL6_REP1_data/Blocks/chr2_+_7_152722998-164058885\n",
      "writing file BL6_REP1_data/Blocks/chr2_+_8_164060851-181960332\n",
      "writing file BL6_REP1_data/Blocks/chr5_+_0_3016930-29821901\n",
      "writing file BL6_REP1_data/Blocks/chr5_+_1_29823562-36477453\n",
      "writing file BL6_REP1_data/Blocks/chr5_+_2_36481703-72816337\n",
      "writing file BL6_REP1_data/Blocks/chr5_+_3_72862661-103861157\n",
      "writing file BL6_REP1_data/Blocks/chr5_+_4_103862229-115111002\n",
      "writing file BL6_REP1_data/Blocks/chr5_+_5_115119894-123971141\n",
      "writing file BL6_REP1_data/Blocks/chr5_+_6_123973007-139250160\n",
      "writing file BL6_REP1_data/Blocks/chr5_+_7_139252237-151648384\n",
      "writing file BL6_REP1_data/Blocks/chr14_-_0_3051588-29080009\n",
      "writing file BL6_REP1_data/Blocks/chr14_-_1_29085951-52330182\n",
      "writing file BL6_REP1_data/Blocks/chr14_-_2_52344941-65835518\n",
      "writing file BL6_REP1_data/Blocks/chr14_-_3_65836521-78651767\n",
      "writing file BL6_REP1_data/Blocks/chr14_-_4_78653614-124689347\n",
      "writing file BL6_REP1_data/Blocks/chr4_-_0_3087227-41760891\n",
      "writing file BL6_REP1_data/Blocks/chr4_-_1_41764001-62525341\n",
      "writing file BL6_REP1_data/Blocks/chr4_-_2_62536767-99748067\n",
      "writing file BL6_REP1_data/Blocks/chr4_-_3_99756942-120802226\n",
      "writing file BL6_REP1_data/Blocks/chr4_-_4_120804064-133367050\n",
      "writing file BL6_REP1_data/Blocks/chr4_-_5_133387921-145196669\n",
      "writing file BL6_REP1_data/Blocks/chr4_-_6_145202540-156252068\n",
      "writing file BL6_REP1_data/Blocks/chr3_+_0_3345182-37504939\n",
      "writing file BL6_REP1_data/Blocks/chr3_+_1_37505982-68637286\n",
      "writing file BL6_REP1_data/Blocks/chr3_+_2_68638566-90369646\n",
      "writing file BL6_REP1_data/Blocks/chr3_+_3_90372765-104029074\n",
      "writing file BL6_REP1_data/Blocks/chr3_+_4_104030810-133379934\n",
      "writing file BL6_REP1_data/Blocks/chr3_+_5_133387721-159938934\n",
      "writing file BL6_REP1_data/Blocks/chr9_+_0_3316787-23502341\n",
      "writing file BL6_REP1_data/Blocks/chr9_+_1_23503700-46227890\n",
      "writing file BL6_REP1_data/Blocks/chr9_+_2_46229770-62380895\n",
      "writing file BL6_REP1_data/Blocks/chr9_+_3_62383774-72752443\n",
      "writing file BL6_REP1_data/Blocks/chr9_+_4_72753857-99679181\n",
      "writing file BL6_REP1_data/Blocks/chr9_+_5_99694399-110864700\n",
      "writing file BL6_REP1_data/Blocks/chr9_+_6_110866382-124475646\n",
      "writing file BL6_REP1_data/Blocks/chr1_-_0_3063317-36369163\n",
      "writing file BL6_REP1_data/Blocks/chr1_-_1_36376489-57007376\n",
      "writing file BL6_REP1_data/Blocks/chr1_-_2_57009234-74506552\n",
      "writing file BL6_REP1_data/Blocks/chr1_-_3_74516459-97786211\n",
      "writing file BL6_REP1_data/Blocks/chr1_-_4_97805826-133661385\n",
      "writing file BL6_REP1_data/Blocks/chr1_-_5_133675944-152903116\n",
      "writing file BL6_REP1_data/Blocks/chr1_-_6_152921085-166034819\n",
      "writing file BL6_REP1_data/Blocks/chr1_-_7_166042265-181020905\n",
      "writing file BL6_REP1_data/Blocks/chr1_-_8_181034470-195329697\n",
      "writing file BL6_REP1_data/Blocks/chr17_+_0_3055606-13041802\n",
      "writing file BL6_REP1_data/Blocks/chr17_+_1_13043552-26448992\n",
      "writing file BL6_REP1_data/Blocks/chr17_+_2_26452655-34603621\n",
      "writing file BL6_REP1_data/Blocks/chr17_+_3_34604698-56409494\n",
      "writing file BL6_REP1_data/Blocks/chr17_+_4_56412766-75395793\n",
      "writing file BL6_REP1_data/Blocks/chr17_+_5_75397255-94879788\n",
      "writing file BL6_REP1_data/Blocks/chr16_-_0_3042366-18138962\n",
      "writing file BL6_REP1_data/Blocks/chr16_-_1_18140075-34574403\n",
      "writing file BL6_REP1_data/Blocks/chr16_-_2_34587492-64852995\n",
      "writing file BL6_REP1_data/Blocks/chr16_-_3_64855739-98082503\n",
      "writing file BL6_REP1_data/Blocks/chr8_-_0_3080105-26158552\n",
      "writing file BL6_REP1_data/Blocks/chr8_-_1_26160744-64699238\n",
      "writing file BL6_REP1_data/Blocks/chr8_-_2_64701103-79150795\n",
      "writing file BL6_REP1_data/Blocks/chr8_-_3_79153535-102680001\n",
      "writing file BL6_REP1_data/Blocks/chr8_-_4_102681471-117140208\n",
      "writing file BL6_REP1_data/Blocks/chr8_-_5_117141774-129293587\n",
      "writing file BL6_REP1_data/Blocks/chr6_+_0_3200780-29912382\n",
      "writing file BL6_REP1_data/Blocks/chr6_+_1_29914306-47539965\n",
      "writing file BL6_REP1_data/Blocks/chr6_+_2_47542357-70901749\n",
      "writing file BL6_REP1_data/Blocks/chr6_+_3_70903622-88835401\n",
      "writing file BL6_REP1_data/Blocks/chr6_+_4_88836708-115627960\n",
      "writing file BL6_REP1_data/Blocks/chr6_+_5_115629191-134979352\n",
      "writing file BL6_REP1_data/Blocks/chr6_+_6_134980426-149585979\n",
      "writing file BL6_REP1_data/Blocks/chr3_-_0_3633294-35942485\n",
      "writing file BL6_REP1_data/Blocks/chr3_-_1_35943524-75557017\n",
      "writing file BL6_REP1_data/Blocks/chr3_-_2_75768627-95015916\n",
      "writing file BL6_REP1_data/Blocks/chr3_-_3_95021126-108240102\n",
      "writing file BL6_REP1_data/Blocks/chr3_-_4_108242389-133618049\n",
      "writing file BL6_REP1_data/Blocks/chr3_-_5_133893879-159937567\n",
      "writing file BL6_REP1_data/Blocks/chr12_-_0_3006263-51692356\n",
      "writing file BL6_REP1_data/Blocks/chr12_-_1_51708539-80260812\n",
      "writing file BL6_REP1_data/Blocks/chr12_-_2_80263421-100432751\n",
      "writing file BL6_REP1_data/Blocks/chr12_-_3_100434216-119876462\n",
      "writing file BL6_REP1_data/Blocks/chr15_+_0_3053635-33036042\n",
      "writing file BL6_REP1_data/Blocks/chr15_+_1_33042284-59605305\n",
      "writing file BL6_REP1_data/Blocks/chr15_+_2_59606391-80398353\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file BL6_REP1_data/Blocks/chr15_+_3_80400051-93245109\n",
      "writing file BL6_REP1_data/Blocks/chr15_+_4_93247913-103828558\n",
      "writing file BL6_REP1_data/Blocks/chr7_+_0_3102181-27536405\n",
      "writing file BL6_REP1_data/Blocks/chr7_+_1_27537592-45889129\n",
      "writing file BL6_REP1_data/Blocks/chr7_+_2_45890435-68248421\n",
      "writing file BL6_REP1_data/Blocks/chr7_+_3_68251998-92928864\n",
      "writing file BL6_REP1_data/Blocks/chr7_+_4_92929961-102025115\n",
      "writing file BL6_REP1_data/Blocks/chr7_+_5_102026253-120836307\n",
      "writing file BL6_REP1_data/Blocks/chr7_+_6_120839628-133725001\n",
      "writing file BL6_REP1_data/Blocks/chr7_+_7_133727584-145326079\n",
      "writing file BL6_REP1_data/Blocks/chr17_-_0_3040678-25015808\n",
      "writing file BL6_REP1_data/Blocks/chr17_-_1_25033033-34899464\n",
      "writing file BL6_REP1_data/Blocks/chr17_-_2_34903110-56167083\n",
      "writing file BL6_REP1_data/Blocks/chr17_-_3_56171417-74329921\n",
      "writing file BL6_REP1_data/Blocks/chr17_-_4_74332251-94864638\n",
      "writing file BL6_REP1_data/Blocks/chr13_-_0_3137393-37435226\n",
      "writing file BL6_REP1_data/Blocks/chr13_-_1_37439403-55100302\n",
      "writing file BL6_REP1_data/Blocks/chr13_-_2_55112292-74390809\n",
      "writing file BL6_REP1_data/Blocks/chr13_-_3_74414024-103173063\n",
      "writing file BL6_REP1_data/Blocks/chr13_-_4_103175334-120304532\n",
      "writing file BL6_REP1_data/Blocks/chr14_+_0_3055087-22962285\n",
      "writing file BL6_REP1_data/Blocks/chr14_+_1_23023271-47113685\n",
      "writing file BL6_REP1_data/Blocks/chr14_+_2_47114735-63153366\n",
      "writing file BL6_REP1_data/Blocks/chr14_+_3_63158349-99215826\n",
      "writing file BL6_REP1_data/Blocks/chr14_+_4_99217487-124369137\n",
      "writing file BL6_REP1_data/Blocks/chrX_-_0_3704427-52165383\n",
      "writing file BL6_REP1_data/Blocks/chrX_-_1_52210707-104965455\n",
      "writing file BL6_REP1_data/Blocks/chrX_-_2_104973245-170673449\n",
      "writing file BL6_REP1_data/Blocks/chr1_+_0_3279785-39000306\n",
      "writing file BL6_REP1_data/Blocks/chr1_+_1_39001521-59996852\n",
      "writing file BL6_REP1_data/Blocks/chr1_+_2_59998481-82914445\n",
      "writing file BL6_REP1_data/Blocks/chr1_+_3_82915514-93373532\n",
      "writing file BL6_REP1_data/Blocks/chr1_+_4_93401773-132098751\n",
      "writing file BL6_REP1_data/Blocks/chr1_+_5_132099837-156664292\n",
      "writing file BL6_REP1_data/Blocks/chr1_+_6_156666048-179687272\n",
      "writing file BL6_REP1_data/Blocks/chr1_+_7_179693877-195323771\n",
      "writing file BL6_REP1_data/Blocks/chr10_+_0_3366606-28598498\n",
      "writing file BL6_REP1_data/Blocks/chr10_+_1_28602030-58565316\n",
      "writing file BL6_REP1_data/Blocks/chr10_+_2_58570398-76763370\n",
      "writing file BL6_REP1_data/Blocks/chr10_+_3_76789847-84736442\n",
      "writing file BL6_REP1_data/Blocks/chr10_+_4_84739037-108288788\n",
      "writing file BL6_REP1_data/Blocks/chr10_+_5_108289846-130586344\n",
      "writing file BL6_REP1_data/Blocks/chrX_+_0_3456134-56796725\n",
      "writing file BL6_REP1_data/Blocks/chrX_+_1_56798351-99075550\n",
      "writing file BL6_REP1_data/Blocks/chrX_+_2_99076600-142753393\n",
      "writing file BL6_REP1_data/Blocks/chrX_+_3_142754688-170677766\n",
      "writing file BL6_REP1_data/Blocks/chr4_+_0_3376312-33552159\n",
      "writing file BL6_REP1_data/Blocks/chr4_+_1_33617925-53623951\n",
      "writing file BL6_REP1_data/Blocks/chr4_+_2_53627195-85050856\n",
      "writing file BL6_REP1_data/Blocks/chr4_+_3_85053424-107644017\n",
      "writing file BL6_REP1_data/Blocks/chr4_+_4_107646680-123311315\n",
      "writing file BL6_REP1_data/Blocks/chr4_+_5_123312738-134938037\n",
      "writing file BL6_REP1_data/Blocks/chr4_+_6_134939779-147516788\n",
      "writing file BL6_REP1_data/Blocks/chr4_+_7_147518518-156318454\n",
      "writing file BL6_REP1_data/Blocks/chr5_-_0_3182383-31296346\n",
      "writing file BL6_REP1_data/Blocks/chr5_-_1_31298993-62736712\n",
      "writing file BL6_REP1_data/Blocks/chr5_-_2_62738087-92280448\n",
      "writing file BL6_REP1_data/Blocks/chr5_-_3_92282063-113388101\n",
      "writing file BL6_REP1_data/Blocks/chr5_-_4_113486417-124531417\n",
      "writing file BL6_REP1_data/Blocks/chr5_-_5_124532511-139775643\n",
      "writing file BL6_REP1_data/Blocks/chr5_-_6_139783282-151683797\n",
      "writing file BL6_REP1_data/Blocks/chr2_-_0_3149102-25623400\n",
      "writing file BL6_REP1_data/Blocks/chr2_-_1_25624631-34832207\n",
      "writing file BL6_REP1_data/Blocks/chr2_-_2_34840642-64098561\n",
      "writing file BL6_REP1_data/Blocks/chr2_-_3_64167039-91209259\n",
      "writing file BL6_REP1_data/Blocks/chr2_-_4_91210374-114205505\n",
      "writing file BL6_REP1_data/Blocks/chr2_-_5_114228293-125782893\n",
      "writing file BL6_REP1_data/Blocks/chr2_-_6_125825252-150544460\n",
      "writing file BL6_REP1_data/Blocks/chr2_-_7_150548612-164071182\n",
      "writing file BL6_REP1_data/Blocks/chr2_-_8_164076888-182006734\n",
      "writing file BL6_REP1_data/Blocks/chr19_+_0_3033537-11999345\n",
      "writing file BL6_REP1_data/Blocks/chr19_+_1_12008237-36461011\n",
      "writing file BL6_REP1_data/Blocks/chr19_+_2_36463365-46883505\n",
      "writing file BL6_REP1_data/Blocks/chr19_+_3_46886807-61270467\n",
      "writing file BL6_REP1_data/Blocks/chr11_+_0_3123506-21900080\n",
      "writing file BL6_REP1_data/Blocks/chr11_+_1_21901214-45917337\n",
      "writing file BL6_REP1_data/Blocks/chr11_+_2_45919732-58355921\n",
      "writing file BL6_REP1_data/Blocks/chr11_+_3_58373262-70058100\n",
      "writing file BL6_REP1_data/Blocks/chr11_+_4_70059449-78061758\n",
      "writing file BL6_REP1_data/Blocks/chr11_+_5_78063766-88086233\n",
      "writing file BL6_REP1_data/Blocks/chr11_+_6_88087437-101343251\n",
      "writing file BL6_REP1_data/Blocks/chr11_+_7_101352269-115892713\n",
      "writing file BL6_REP1_data/Blocks/chr11_+_8_115893822-121860060\n",
      "writing file BL6_REP1_data/Blocks/chr12_+_0_3008348-21049196\n",
      "writing file BL6_REP1_data/Blocks/chr12_+_1_21050256-52588032\n",
      "writing file BL6_REP1_data/Blocks/chr12_+_2_52589045-76341181\n",
      "writing file BL6_REP1_data/Blocks/chr12_+_3_76344842-85141748\n",
      "writing file BL6_REP1_data/Blocks/chr12_+_4_85153864-108856884\n",
      "writing file BL6_REP1_data/Blocks/chr12_+_5_108857928-119876831\n",
      "writing file BL6_REP1_data/Blocks/chr13_+_0_3043636-34078052\n",
      "writing file BL6_REP1_data/Blocks/chr13_+_1_34114470-55140933\n",
      "writing file BL6_REP1_data/Blocks/chr13_+_2_55141936-77215188\n",
      "writing file BL6_REP1_data/Blocks/chr13_+_3_77216412-100137755\n",
      "writing file BL6_REP1_data/Blocks/chr13_+_4_100139002-120304427\n",
      "writing file BL6_REP1_data/Blocks/chr6_-_0_3136085-33973766\n",
      "writing file BL6_REP1_data/Blocks/chr6_-_1_33985331-52279513\n",
      "writing file BL6_REP1_data/Blocks/chr6_-_2_52280716-85375514\n",
      "writing file BL6_REP1_data/Blocks/chr6_-_3_85396576-97206056\n",
      "writing file BL6_REP1_data/Blocks/chr6_-_4_97207888-117634888\n",
      "writing file BL6_REP1_data/Blocks/chr6_-_5_117637068-130266790\n",
      "writing file BL6_REP1_data/Blocks/chr6_-_6_130290828-149559879\n",
      "writing file BL6_REP1_data/Blocks/chr11_-_0_3102234-20283359\n",
      "writing file BL6_REP1_data/Blocks/chr11_-_1_20286525-48011812\n",
      "writing file BL6_REP1_data/Blocks/chr11_-_2_48289794-61579712\n",
      "writing file BL6_REP1_data/Blocks/chr11_-_3_61591635-75207215\n",
      "writing file BL6_REP1_data/Blocks/chr11_-_4_75253579-84880932\n",
      "writing file BL6_REP1_data/Blocks/chr11_-_5_84888042-96830422\n",
      "writing file BL6_REP1_data/Blocks/chr11_-_6_96841299-103954019\n",
      "writing file BL6_REP1_data/Blocks/chr11_-_7_103962545-115708596\n",
      "writing file BL6_REP1_data/Blocks/chr11_-_8_115724279-121945459\n",
      "writing file BL6_REP1_data/Blocks/chr18_+_0_3142377-31785605\n",
      "writing file BL6_REP1_data/Blocks/chr18_+_1_31788455-46627528\n",
      "writing file BL6_REP1_data/Blocks/chr18_+_2_46628728-67408026\n",
      "writing file BL6_REP1_data/Blocks/chr18_+_3_67409213-90600877\n"
     ]
    }
   ],
   "source": [
    "total = 0\n",
    "files = glob.glob(root_dir+\"/*.txt\")\n",
    "info = open(root_dir+'/Blocks/info.txt','w')\n",
    "info.write('ID\\tstart\\tend\\tlength\\tsites_num\\n')\n",
    "for file in files:\n",
    "    num_lines = sum(1 for line in open(file))\n",
    "    num_blocks = round(num_lines/Fixed_length)\n",
    "    len_blocks = num_lines/num_blocks\n",
    "    \n",
    "    f= open(file,'r')\n",
    "    pre_pos = 0\n",
    "    dict_line = OrderedDict()\n",
    "    #dict_line = dict()\n",
    "    count = 0\n",
    "    separate_num=0\n",
    "    save_block = 0\n",
    "    start = 0\n",
    "    \n",
    "    for i, line in enumerate(f):\n",
    "        line = line.rstrip('\\n')\n",
    "        if(i==0):\n",
    "            continue ###Skip header\n",
    "        chromosome,pos,strand = line.split('\\t')[0].split(':')\n",
    "        pos = int(pos)\n",
    "        count += 1\n",
    "        if(i==1):\n",
    "            start=pos\n",
    "        if(count>len_blocks and pos-pre_pos>1000 and save_block<num_blocks-1):\n",
    "            array = Gene_Loc[chromosome+strand]\n",
    "            index1,index2 = binary_locate(array,pre_pos,0,len(array)-1)\n",
    "            if(index1%2==1 and index2%2==0):\n",
    "                ww = open(root_dir+'/Blocks/%s_%s_%d'%(chromosome,strand,save_block),'w')\n",
    "                print('writing file '+root_dir+'/Blocks/%s_%s_%d_%d-%d'%(chromosome,strand,save_block,start,pre_pos))\n",
    "                info.write('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "                #print('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "                for key,val in dict_line.items():\n",
    "                    ww.write('%s\\n'%val)\n",
    "                ww.close()\n",
    "                dict_line.clear()\n",
    "                count = 0\n",
    "                save_block += 1\n",
    "                start  = pos\n",
    "            \n",
    "        \n",
    "        dict_line[pos] = line\n",
    "        pre_pos = pos\n",
    "        \n",
    "    out = open(root_dir+'/Blocks/%s_%s_%d'%(chromosome,strand,save_block),'w')\n",
    "    print('writing file '+root_dir+'/Blocks/%s_%s_%d_%d-%d'%(chromosome,strand,save_block,start,pre_pos))\n",
    "    info.write('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "    for key,val in dict_line.items():\n",
    "        out.write('%s\\n'%(val))\n",
    "    out.close()\n",
    "\n",
    "info.close()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(38356578, 38356674)"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "array[678],array[679]"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
