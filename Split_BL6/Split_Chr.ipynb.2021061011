{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import glob\n",
    "from collections import OrderedDict,defaultdict\n",
    "import pipes\n",
    "import pprint\n",
    "import tempfile\n",
    "import re"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "root_dir = 'K562_Chen_data'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "####Fixed length 1e6 = 100 blocks. \n",
    "####Fixed length 5e5 = 200 blocks. \n",
    "Fixed_length = 1.5e6"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "def binary_locate(array,ele,start,end):\n",
    "    middle = (end+start)//2\n",
    "    if(end-start>1):\n",
    "        if(array[middle]<ele):\n",
    "            return binary_locate(array,ele,middle,end)\n",
    "        elif(array[middle+1]>ele):\n",
    "            return binary_locate(array,ele,start,middle)\n",
    "        else:\n",
    "            return middle,middle+1\n",
    "    else:\n",
    "        return middle,middle+1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "p = pipes.Template()\n",
    "p.append(\"zcat\", '--')\n",
    "Gene_Loc = defaultdict(list)\n",
    "f = p.open('/home/longy/cnda/ensembl/Homo_sapiens.GRCh38.103.gtf.gz', 'r')\n",
    "\n",
    "#f = p.open('/home/longy/cnda/ensembl/Mus_musculus.GRCm38.102.gtf.gz', 'r')\n",
    "for line in f.readlines():\n",
    "    if re.match('^#',line):\n",
    "        continue\n",
    "    line = line.rstrip('\\n')\n",
    "    data = line.split('\\t')\n",
    "    if(data[2] == 'gene'):\n",
    "        Gene_Loc['chr'+data[0]+data[6]].append(int(data[3]))\n",
    "        Gene_Loc['chr'+data[0]+data[6]].append(int(data[4]))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(1523, 1524)"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import sys\n",
    "sys.setrecursionlimit(10000)\n",
    "array = Gene_Loc['chr1+']\n",
    "binary_locate(array,46104790,0,3505)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file K562_Chen_data/Blocks/chr18_-_0_47983-36129805\n",
      "writing file K562_Chen_data/Blocks/chr18_-_1_36154880-80247429\n",
      "writing file K562_Chen_data/Blocks/chr20_-_0_214941-30631157\n",
      "writing file K562_Chen_data/Blocks/chr20_-_1_30633389-46011660\n",
      "writing file K562_Chen_data/Blocks/chr20_-_2_46013480-64333153\n",
      "writing file K562_Chen_data/Blocks/chr20_+_0_130003-29489305\n",
      "writing file K562_Chen_data/Blocks/chr20_+_1_29490793-45083642\n",
      "writing file K562_Chen_data/Blocks/chr20_+_2_45085356-64329721\n",
      "writing file K562_Chen_data/Blocks/chr2_-_0_39343-27393724\n",
      "writing file K562_Chen_data/Blocks/chr2_-_1_27397719-54272101\n",
      "writing file K562_Chen_data/Blocks/chr2_-_2_54274086-73816760\n",
      "writing file K562_Chen_data/Blocks/chr2_-_3_73820337-99156435\n",
      "writing file K562_Chen_data/Blocks/chr2_-_4_99159671-127799050\n",
      "writing file K562_Chen_data/Blocks/chr2_-_5_127801339-159616589\n",
      "writing file K562_Chen_data/Blocks/chr2_-_6_159635162-185450415\n",
      "writing file K562_Chen_data/Blocks/chr2_-_7_185546824-212429415\n",
      "writing file K562_Chen_data/Blocks/chr2_-_8_212537062-242180305\n",
      "writing file K562_Chen_data/Blocks/chr5_+_0_50730-32604120\n",
      "writing file K562_Chen_data/Blocks/chr5_+_1_32605209-65643594\n",
      "writing file K562_Chen_data/Blocks/chr5_+_2_65645540-86088670\n",
      "writing file K562_Chen_data/Blocks/chr5_+_3_86213329-109870680\n",
      "writing file K562_Chen_data/Blocks/chr5_+_4_109872193-135268856\n",
      "writing file K562_Chen_data/Blocks/chr5_+_5_135272717-154461074\n",
      "writing file K562_Chen_data/Blocks/chr5_+_6_154468873-181478096\n",
      "writing file K562_Chen_data/Blocks/chr12_+_0_11688-19942716\n",
      "writing file K562_Chen_data/Blocks/chr12_+_1_19944391-48254331\n",
      "writing file K562_Chen_data/Blocks/chr12_+_2_48257384-63809564\n",
      "writing file K562_Chen_data/Blocks/chr12_+_3_63822087-95516126\n",
      "writing file K562_Chen_data/Blocks/chr12_+_4_95548038-116576789\n",
      "writing file K562_Chen_data/Blocks/chr12_+_5_116578015-133225754\n",
      "writing file K562_Chen_data/Blocks/chr17_-_0_61703-16353667\n",
      "writing file K562_Chen_data/Blocks/chr17_-_1_16367643-37626849\n",
      "writing file K562_Chen_data/Blocks/chr17_-_2_37628504-47857090\n",
      "writing file K562_Chen_data/Blocks/chr17_-_3_47864456-68457502\n",
      "writing file K562_Chen_data/Blocks/chr17_-_4_68491834-83241808\n",
      "writing file K562_Chen_data/Blocks/chr6_-_0_67465-26126191\n",
      "writing file K562_Chen_data/Blocks/chr6_-_1_26138194-33456325\n",
      "writing file K562_Chen_data/Blocks/chr6_-_2_33478735-57857010\n",
      "writing file K562_Chen_data/Blocks/chr6_-_3_57858142-96521769\n",
      "writing file K562_Chen_data/Blocks/chr6_-_4_96542903-119286774\n",
      "writing file K562_Chen_data/Blocks/chr6_-_5_119288358-145606395\n",
      "writing file K562_Chen_data/Blocks/chr6_-_6_145611165-170745736\n",
      "writing file K562_Chen_data/Blocks/chr7_-_0_12921-20217699\n",
      "writing file K562_Chen_data/Blocks/chr7_-_1_20331168-44490887\n",
      "writing file K562_Chen_data/Blocks/chr7_-_2_44513505-77697424\n",
      "writing file K562_Chen_data/Blocks/chr7_-_3_77723008-102444653\n",
      "writing file K562_Chen_data/Blocks/chr7_-_4_102446884-119913010\n",
      "writing file K562_Chen_data/Blocks/chr7_-_5_119914444-142904873\n",
      "writing file K562_Chen_data/Blocks/chr7_-_6_142908481-159335436\n",
      "writing file K562_Chen_data/Blocks/chrX_-_0_11658-41707361\n",
      "writing file K562_Chen_data/Blocks/chrX_-_1_41721737-75173731\n",
      "writing file K562_Chen_data/Blocks/chrX_-_2_75178447-125137240\n",
      "writing file K562_Chen_data/Blocks/chrX_-_3_125138264-156028488\n",
      "writing file K562_Chen_data/Blocks/chr1_-_0_13036-16239367\n",
      "writing file K562_Chen_data/Blocks/chr1_-_1_16241138-29230950\n",
      "writing file K562_Chen_data/Blocks/chr1_-_2_29260752-45348141\n",
      "writing file K562_Chen_data/Blocks/chr1_-_3_45349394-67083033\n",
      "writing file K562_Chen_data/Blocks/chr1_-_4_67134562-99766653\n",
      "writing file K562_Chen_data/Blocks/chr1_-_5_99770683-143214800\n",
      "writing file K562_Chen_data/Blocks/chr1_-_6_143313385-156283866\n",
      "writing file K562_Chen_data/Blocks/chr1_-_7_156285348-180438665\n",
      "writing file K562_Chen_data/Blocks/chr1_-_8_180445244-202959696\n",
      "writing file K562_Chen_data/Blocks/chr1_-_9_202961850-227747784\n",
      "writing file K562_Chen_data/Blocks/chr1_-_10_227794719-248936826\n",
      "writing file K562_Chen_data/Blocks/chr22_+_0_10685481-31134714\n",
      "writing file K562_Chen_data/Blocks/chr22_+_1_31136534-50804637\n",
      "writing file K562_Chen_data/Blocks/chr22_-_0_10529074-30251525\n",
      "writing file K562_Chen_data/Blocks/chr22_-_1_30262417-50804637\n",
      "writing file K562_Chen_data/Blocks/chr8_+_0_67090-26426251\n",
      "writing file K562_Chen_data/Blocks/chr8_+_1_26430710-52729062\n",
      "writing file K562_Chen_data/Blocks/chr8_+_2_52744520-90572225\n",
      "writing file K562_Chen_data/Blocks/chr8_+_3_90573420-123152176\n",
      "writing file K562_Chen_data/Blocks/chr8_+_4_123157380-145067168\n",
      "writing file K562_Chen_data/Blocks/chr16_+_0_10798-15095181\n",
      "writing file K562_Chen_data/Blocks/chr16_+_1_15096559-31133521\n",
      "writing file K562_Chen_data/Blocks/chr16_+_2_31134969-70162550\n",
      "writing file K562_Chen_data/Blocks/chr16_+_3_70174377-90228203\n",
      "writing file K562_Chen_data/Blocks/chr4_-_0_34902-27073254\n",
      "writing file K562_Chen_data/Blocks/chr4_-_1_27074888-67701167\n",
      "writing file K562_Chen_data/Blocks/chr4_-_2_67720405-89113387\n",
      "writing file K562_Chen_data/Blocks/chr4_-_3_89133499-126404458\n",
      "writing file K562_Chen_data/Blocks/chr4_-_4_126405586-152495670\n",
      "writing file K562_Chen_data/Blocks/chr4_-_5_152504438-190118373\n",
      "writing file K562_Chen_data/Blocks/chr2_+_0_262641-28003850\n",
      "writing file K562_Chen_data/Blocks/chr2_+_1_28005888-48515857\n",
      "writing file K562_Chen_data/Blocks/chr2_+_2_48516929-72892168\n",
      "writing file K562_Chen_data/Blocks/chr2_+_3_72898325-99187041\n",
      "writing file K562_Chen_data/Blocks/chr2_+_4_99188178-122914925\n",
      "writing file K562_Chen_data/Blocks/chr2_+_5_122964434-156614184\n",
      "writing file K562_Chen_data/Blocks/chr2_+_6_156729185-178404014\n",
      "writing file K562_Chen_data/Blocks/chr2_+_7_178413450-196764980\n",
      "writing file K562_Chen_data/Blocks/chr2_+_8_196768316-219027917\n",
      "writing file K562_Chen_data/Blocks/chr2_+_9_219030836-242181456\n",
      "writing file K562_Chen_data/Blocks/chr21_+_0_5026530-33364589\n",
      "writing file K562_Chen_data/Blocks/chr21_+_1_33376801-46699316\n",
      "writing file K562_Chen_data/Blocks/chr21_-_0_5031887-32279865\n",
      "writing file K562_Chen_data/Blocks/chr21_-_1_32281006-46694033\n",
      "writing file K562_Chen_data/Blocks/chr3_+_0_144167-16351968\n",
      "writing file K562_Chen_data/Blocks/chr3_+_1_16354449-40454825\n",
      "writing file K562_Chen_data/Blocks/chr3_+_2_40457282-52696850\n",
      "writing file K562_Chen_data/Blocks/chr3_+_3_52705300-100751677\n",
      "writing file K562_Chen_data/Blocks/chr3_+_4_100754603-129306188\n",
      "writing file K562_Chen_data/Blocks/chr3_+_5_129310174-152466065\n",
      "writing file K562_Chen_data/Blocks/chr3_+_6_152467141-181533052\n",
      "writing file K562_Chen_data/Blocks/chr3_+_7_181566609-198230087\n",
      "writing file K562_Chen_data/Blocks/chr18_+_0_37677-31179111\n",
      "writing file K562_Chen_data/Blocks/chr18_+_1_31182799-80263074\n",
      "writing file K562_Chen_data/Blocks/chr9_+_0_12641-40267347\n",
      "writing file K562_Chen_data/Blocks/chr9_+_1_40271899-95022346\n",
      "writing file K562_Chen_data/Blocks/chr9_+_2_95024330-125237018\n",
      "writing file K562_Chen_data/Blocks/chr9_+_3_125238960-138334465\n",
      "writing file K562_Chen_data/Blocks/chr11_+_0_123368-15520287\n",
      "writing file K562_Chen_data/Blocks/chr11_+_1_15561833-46244109\n",
      "writing file K562_Chen_data/Blocks/chr11_+_2_46256493-65656165\n",
      "writing file K562_Chen_data/Blocks/chr11_+_3_65657320-76554301\n",
      "writing file K562_Chen_data/Blocks/chr11_+_4_76555336-112172566\n",
      "writing file K562_Chen_data/Blocks/chr11_+_5_112178350-134897563\n",
      "writing file K562_Chen_data/Blocks/chr4_+_0_18819-20754729\n",
      "writing file K562_Chen_data/Blocks/chr4_+_1_20756549-53444557\n",
      "writing file K562_Chen_data/Blocks/chr4_+_2_53446657-80963905\n",
      "writing file K562_Chen_data/Blocks/chr4_+_3_81031511-112387611\n",
      "writing file K562_Chen_data/Blocks/chr4_+_4_112392935-143925804\n",
      "writing file K562_Chen_data/Blocks/chr4_+_5_143927602-190203219\n",
      "writing file K562_Chen_data/Blocks/chr12_-_0_12545-22544546\n",
      "writing file K562_Chen_data/Blocks/chr12_-_1_22622049-48957509\n",
      "writing file K562_Chen_data/Blocks/chr12_-_2_48965091-64338802\n",
      "writing file K562_Chen_data/Blocks/chr12_-_3_64352110-94424377\n",
      "writing file K562_Chen_data/Blocks/chr12_-_4_94433980-116738075\n",
      "writing file K562_Chen_data/Blocks/chr12_-_5_116740161-133258142\n",
      "writing file K562_Chen_data/Blocks/chr7_+_0_20714-21023362\n",
      "writing file K562_Chen_data/Blocks/chr7_+_1_21024638-45110234\n",
      "writing file K562_Chen_data/Blocks/chr7_+_2_45112122-77123034\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "writing file K562_Chen_data/Blocks/chr7_+_3_77131624-100569423\n",
      "writing file K562_Chen_data/Blocks/chr7_+_4_100575776-121304264\n",
      "writing file K562_Chen_data/Blocks/chr7_+_5_121305899-141842836\n",
      "writing file K562_Chen_data/Blocks/chr7_+_6_141843886-159291636\n",
      "writing file K562_Chen_data/Blocks/chr16_-_0_10052-12818859\n",
      "writing file K562_Chen_data/Blocks/chr16_-_1_12992266-31160704\n",
      "writing file K562_Chen_data/Blocks/chr16_-_2_31178684-71759744\n",
      "writing file K562_Chen_data/Blocks/chr16_-_3_71761489-90228222\n",
      "writing file K562_Chen_data/Blocks/chr6_+_0_142737-26017779\n",
      "writing file K562_Chen_data/Blocks/chr6_+_1_26020197-34881831\n",
      "writing file K562_Chen_data/Blocks/chr6_+_2_34883005-57085912\n",
      "writing file K562_Chen_data/Blocks/chr6_+_3_57089700-87969099\n",
      "writing file K562_Chen_data/Blocks/chr6_+_4_88058684-125267308\n",
      "writing file K562_Chen_data/Blocks/chr6_+_5_125270339-147955710\n",
      "writing file K562_Chen_data/Blocks/chr6_+_6_147957081-170745793\n",
      "writing file K562_Chen_data/Blocks/chr15_-_0_17030832-43653429\n",
      "writing file K562_Chen_data/Blocks/chr15_-_1_43654972-63842382\n",
      "writing file K562_Chen_data/Blocks/chr15_-_2_63851973-82013290\n",
      "writing file K562_Chen_data/Blocks/chr15_-_3_82041760-101977082\n",
      "writing file K562_Chen_data/Blocks/chr13_-_0_18171311-44577298\n",
      "writing file K562_Chen_data/Blocks/chr13_-_1_44596100-80341333\n",
      "writing file K562_Chen_data/Blocks/chr13_-_2_80432829-114324788\n",
      "writing file K562_Chen_data/Blocks/chrX_+_0_15210-43752174\n",
      "writing file K562_Chen_data/Blocks/chrX_+_1_43786363-74012900\n",
      "writing file K562_Chen_data/Blocks/chrX_+_2_74014805-123887588\n",
      "writing file K562_Chen_data/Blocks/chrX_+_3_123888630-156026293\n",
      "writing file K562_Chen_data/Blocks/chr1_+_0_12858-15940790\n",
      "writing file K562_Chen_data/Blocks/chr1_+_1_15942159-32217374\n",
      "writing file K562_Chen_data/Blocks/chr1_+_2_32221104-44822714\n",
      "writing file K562_Chen_data/Blocks/chr1_+_3_44824205-70446278\n",
      "writing file K562_Chen_data/Blocks/chr1_+_4_70448341-108344604\n",
      "writing file K562_Chen_data/Blocks/chr1_+_5_108358991-145983713\n",
      "writing file K562_Chen_data/Blocks/chr1_+_6_145992845-161146878\n",
      "writing file K562_Chen_data/Blocks/chr1_+_7_161149039-180055420\n",
      "writing file K562_Chen_data/Blocks/chr1_+_8_180056500-204559653\n",
      "writing file K562_Chen_data/Blocks/chr1_+_9_204561481-226073071\n",
      "writing file K562_Chen_data/Blocks/chr1_+_10_226076624-248945576\n",
      "writing file K562_Chen_data/Blocks/chr19_-_0_60115-8652332\n",
      "writing file K562_Chen_data/Blocks/chr19_-_1_8653376-19174272\n",
      "writing file K562_Chen_data/Blocks/chr19_-_2_19175516-39342564\n",
      "writing file K562_Chen_data/Blocks/chr19_-_3_39353983-49388555\n",
      "writing file K562_Chen_data/Blocks/chr19_-_4_49397891-58599405\n",
      "writing file K562_Chen_data/Blocks/chr5_-_0_16089-36877653\n",
      "writing file K562_Chen_data/Blocks/chr5_-_1_36893818-71189933\n",
      "writing file K562_Chen_data/Blocks/chr5_-_2_71191534-95554999\n",
      "writing file K562_Chen_data/Blocks/chr5_-_3_95613600-132295346\n",
      "writing file K562_Chen_data/Blocks/chr5_-_4_132300665-151447964\n",
      "writing file K562_Chen_data/Blocks/chr5_-_5_151521273-181470916\n",
      "writing file K562_Chen_data/Blocks/chr10_-_0_55467-22056367\n",
      "writing file K562_Chen_data/Blocks/chr10_-_1_22058806-49979436\n",
      "writing file K562_Chen_data/Blocks/chr10_-_2_50009554-79445631\n",
      "writing file K562_Chen_data/Blocks/chr10_-_3_79449206-102105232\n",
      "writing file K562_Chen_data/Blocks/chr10_-_4_102106470-133770304\n",
      "writing file K562_Chen_data/Blocks/chr19_+_0_71036-11121570\n",
      "writing file K562_Chen_data/Blocks/chr19_+_1_11122656-21498245\n",
      "writing file K562_Chen_data/Blocks/chr19_+_2_21505600-40771948\n",
      "writing file K562_Chen_data/Blocks/chr19_+_3_40773710-50089057\n",
      "writing file K562_Chen_data/Blocks/chr19_+_4_50091355-58605506\n",
      "writing file K562_Chen_data/Blocks/chr3_-_0_376266-33741654\n",
      "writing file K562_Chen_data/Blocks/chr3_-_1_33779246-50359570\n",
      "writing file K562_Chen_data/Blocks/chr3_-_2_50363024-94938251\n",
      "writing file K562_Chen_data/Blocks/chr3_-_3_95117104-125595546\n",
      "writing file K562_Chen_data/Blocks/chr3_-_4_125646743-150972846\n",
      "writing file K562_Chen_data/Blocks/chr3_-_5_151032411-183863877\n",
      "writing file K562_Chen_data/Blocks/chr3_-_6_183866094-198217563\n",
      "writing file K562_Chen_data/Blocks/chr9_-_0_13008-34481895\n",
      "writing file K562_Chen_data/Blocks/chr9_-_1_34484629-85774263\n",
      "writing file K562_Chen_data/Blocks/chr9_-_2_85803077-107672289\n",
      "writing file K562_Chen_data/Blocks/chr9_-_3_107687627-127779540\n",
      "writing file K562_Chen_data/Blocks/chr9_-_4_127785690-138269677\n",
      "writing file K562_Chen_data/Blocks/chr8_-_0_61202-30728277\n",
      "writing file K562_Chen_data/Blocks/chr8_-_1_30736358-66793732\n",
      "writing file K562_Chen_data/Blocks/chr8_-_2_66798653-96317708\n",
      "writing file K562_Chen_data/Blocks/chr8_-_3_96333439-126008348\n",
      "writing file K562_Chen_data/Blocks/chr8_-_4_126009488-145053134\n",
      "writing file K562_Chen_data/Blocks/chr11_-_0_67427-12944392\n",
      "writing file K562_Chen_data/Blocks/chr11_-_1_12945414-38315540\n",
      "writing file K562_Chen_data/Blocks/chr11_-_2_38316667-65134795\n",
      "writing file K562_Chen_data/Blocks/chr11_-_3_65138098-77511995\n",
      "writing file K562_Chen_data/Blocks/chr11_-_4_77527498-106028522\n",
      "writing file K562_Chen_data/Blocks/chr11_-_5_106047019-135056647\n",
      "writing file K562_Chen_data/Blocks/chr13_+_0_18171261-45365921\n",
      "writing file K562_Chen_data/Blocks/chr13_+_1_45367006-79556452\n",
      "writing file K562_Chen_data/Blocks/chr13_+_2_79558109-114349135\n",
      "writing file K562_Chen_data/Blocks/chr17_+_0_65501-19979611\n",
      "writing file K562_Chen_data/Blocks/chr17_+_1_20009355-36201481\n",
      "writing file K562_Chen_data/Blocks/chr17_+_2_36207702-47827076\n",
      "writing file K562_Chen_data/Blocks/chr17_+_3_47830945-66810715\n",
      "writing file K562_Chen_data/Blocks/chr17_+_4_66877432-83244918\n",
      "writing file K562_Chen_data/Blocks/chr14_-_0_16024018-49635210\n",
      "writing file K562_Chen_data/Blocks/chr14_-_1_49636564-74713540\n",
      "writing file K562_Chen_data/Blocks/chr14_-_2_74714849-106863556\n",
      "writing file K562_Chen_data/Blocks/chr15_+_0_17010550-43149183\n",
      "writing file K562_Chen_data/Blocks/chr15_+_1_43150622-65578379\n",
      "writing file K562_Chen_data/Blocks/chr15_+_2_65599842-82439869\n",
      "writing file K562_Chen_data/Blocks/chr15_+_3_82442151-101976501\n",
      "writing file K562_Chen_data/Blocks/chr14_+_0_16035740-52728671\n",
      "writing file K562_Chen_data/Blocks/chr14_+_1_52730167-76268132\n",
      "writing file K562_Chen_data/Blocks/chr14_+_2_76274174-106810202\n",
      "writing file K562_Chen_data/Blocks/chr10_+_0_39881-22489523\n",
      "writing file K562_Chen_data/Blocks/chr10_+_1_22491548-60080311\n",
      "writing file K562_Chen_data/Blocks/chr10_+_2_60081700-87372227\n",
      "writing file K562_Chen_data/Blocks/chr10_+_3_87387989-103473801\n",
      "writing file K562_Chen_data/Blocks/chr10_+_4_103476212-133785493\n"
     ]
    }
   ],
   "source": [
    "total = 0\n",
    "files = glob.glob(root_dir+\"/*.txt\")\n",
    "info = open(root_dir+'/Blocks/info.txt','w')\n",
    "info.write('ID\\tstart\\tend\\tlength\\tsites_num\\n')\n",
    "for file in files:\n",
    "    num_lines = sum(1 for line in open(file))\n",
    "    num_blocks = round(num_lines/Fixed_length)\n",
    "    len_blocks = num_lines/num_blocks\n",
    "    \n",
    "    f= open(file,'r')\n",
    "    pre_pos = 0\n",
    "    dict_line = OrderedDict()\n",
    "    #dict_line = dict()\n",
    "    count = 0\n",
    "    separate_num=0\n",
    "    save_block = 0\n",
    "    start = 0\n",
    "    \n",
    "    for i, line in enumerate(f):\n",
    "        line = line.rstrip('\\n')\n",
    "        if(i==0):\n",
    "            continue ###Skip header\n",
    "        chromosome,pos,strand = line.split('\\t')[0].split(':')\n",
    "        pos = int(pos)\n",
    "        count += 1\n",
    "        if(i==1):\n",
    "            start=pos\n",
    "        if(count>len_blocks and pos-pre_pos>1000 and save_block<num_blocks-1):\n",
    "            array = Gene_Loc[chromosome+strand]\n",
    "            index1,index2 = binary_locate(array,pre_pos,0,len(array)-1)\n",
    "            if(index1%2==1 and index2%2==0):\n",
    "                ww = open(root_dir+'/Blocks/%s_%s_%d'%(chromosome,strand,save_block),'w')\n",
    "                print('writing file '+root_dir+'/Blocks/%s_%s_%d_%d-%d'%(chromosome,strand,save_block,start,pre_pos))\n",
    "                info.write('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "                #print('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "                for key,val in dict_line.items():\n",
    "                    ww.write('%s\\n'%val)\n",
    "                ww.close()\n",
    "                dict_line.clear()\n",
    "                count = 0\n",
    "                save_block += 1\n",
    "                start  = pos\n",
    "            \n",
    "        \n",
    "        dict_line[pos] = line\n",
    "        pre_pos = pos\n",
    "        \n",
    "    out = open(root_dir+'/Blocks/%s_%s_%d'%(chromosome,strand,save_block),'w')\n",
    "    print('writing file '+root_dir+'/Blocks/%s_%s_%d_%d-%d'%(chromosome,strand,save_block,start,pre_pos))\n",
    "    info.write('%s_%s_%d\\t%d\\t%d\\t%d\\t%d\\n'%(chromosome,strand,save_block,start,pre_pos,pre_pos-start,count))\n",
    "    for key,val in dict_line.items():\n",
    "        out.write('%s\\n'%(val))\n",
    "    out.close()\n",
    "\n",
    "info.close()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
